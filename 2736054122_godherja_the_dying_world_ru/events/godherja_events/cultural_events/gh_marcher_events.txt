namespace = marcher

##################
##EVENT     LIST##
# marcher.0001
#
#Pet griffon Event
# marcher.0101
# > marcher.0102
#
#Convert griffon to War Griffon
# marcher.0103
# > marcher.0104   
# OR > marcher.0105
#
# marcher.0110
#
# marcher.0115
#
#Random Griffon county attack event chain
#marcher.1150
# > marcher.1155
# >> marcher.1160
# OR > marcher.1165
# OR > marcher.1170
##################

marcher.0001 = { #Event for Rene dying
	title = marcher_war.0001.t
	desc = marcher_war.0001.desc
	theme = battle
	left_portrait = { 
		character = root
	}

	trigger = {
		is_ai = yes
	}	

	option = {
		name = marcher_war.0001.a
		#random declaration of war if the holders of the two kingdom titles aren't the same
		if = {
			limit = {
				NOT = {
					title:k_marroux.holder = title:k_varrdevet.holder
				}
			}
		random_list = {
				25 = {
					#war if the holders of the titles aren't the same
						start_war = {
							casus_belli = marcher_reunification_cb
							target = title:k_marroux.holder
						}
					}
				75 = {
					#no war, but will trigger the same event in a year
					trigger_event = {
						id = marcher_war.0001
						years = 1
					}
					
				}
			}
		}
	}
}

marcher.0101 = { # Chance to get a pet Griffon (introduction)
	title = marcher.0101.t
	desc = marcher.0101.desc
	theme = hunt_activity
	left_portrait = { 
		character = root
	}

	trigger = {
		has_trait = way_of_nullification_follower
		NOR = {
			has_character_flag = artifact_mountgriffon
			has_character_flag = artifact_mountwargriffon
		}
	}	

	option = { # Try and save the Griffon
		name = marcher.0101.a
		custom_tooltip = marcher.0101.a.tt

		hidden_effect = {
			trigger_event = marcher.0102
		}
        
        stress_impact = {
            sadistic = minor_stress_impact_gain
            vengeful = medium_stress_impact_gain
        }
        
        ai_chance = { #Compassionate or ambitious AI will want to go for it
            base = 100
            
            ai_value_modifier = {
                ai_boldness = 0.5
                ai_compassion = 0.5
            } 
        }
	}
	
	option = { # Don't bother with the Griffon
		name = marcher.0101.b
		custom_tooltip = marcher.0101.b.tt
        
        stress_impact = {
            compassionate = major_stress_impact_gain
            ambitious = minor_stress_impact_gain
        }
        
        ai_chance = {
            base = 100
            
            ai_value_modifier = {
                ai_vengefulness = 0.5
            }
        }
	}
}

marcher.0102 = { # Chance to get a pet Griffon (choices)
	title = marcher.0102.t
	desc = marcher.0102.desc
	theme = hunt_activity
	left_portrait = { 
		character = root
	}	
    
    # AI Chance here will go from the perspective that the AI has already made up its mind to save the griffon

	option = {	# Pay a decent amount of cash to heal the griffon
		name = marcher.0102.a
		remove_short_term_gold = 500
		add_artifact = { ARTIFACT = artifact_mountgriffon }
        
        stress_impact = {
            greedy = medium_stress_impact_gain
        }
        
        ai_chance = {
            base = 100
            
            ai_value_modifier = {
                ai_compassion = 0.5
                ai_greed = -0.5
            }
            
            compare_modifier = {
                trigger = {
                    AND = {
                        ai_rationality >= 10 #Rational AI is less likely to bankrupt itself trying to get a griphon
                        ai_compassion <= 75 #Very compassionate AI won't give a shi
                    }
                }
                value = {
                    value = short_term_gold
                    add = -500
                }
            }
        }
	}
	
	option = {	# Use learning, medic or herbalist to heal for free
		name = marcher.0102.b
		trigger = {
			OR = {
				learning > 18
				has_trait = lifestyle_herbalist
				has_trait = physician_1
				has_trait = physician_2
				has_trait = physician_3
			}
		}
		add_artifact = { ARTIFACT = artifact_mountgriffon }
        
        add_learning_lifestyle_perk_points = 1
        
        ai_chance = {
            base = 9999 #AI will always pick this if given the chance
        }
	}
	
	option = { # On second thought, don't bother with the Griffon
		name = marcher.0102.c
        
        stress_impact = {
            compassionate = major_stress_impact_gain
            ambitious = minor_stress_impact_gain
        }
        
        ai_chance = {
            base = 80 #Default option if AI changes its mind, likely due to price
        }
	}
}

marcher.0103 = { # Chance to convert pet Griffon to war Griffon (introduction)
	title = marcher.0103.t
	desc = marcher.0103.desc
	theme = hunt_activity
	left_portrait = { 
		character = root
	}

	trigger = {
		has_character_flag = artifact_mountgriffon
		NOT = {
			has_character_flag = artifact_mountwargriffon
		}
	}	

	option = { # Pay the trainer
		name = marcher.0103.a
		custom_tooltip = marcher.0103.a.tt
		
		remove_short_term_gold = 250
		
		hidden_effect = {
			random_list = {
				75 = { trigger_event = { id = marcher.0104 days = 30 } }	# The trainer is legitimate
				25 = { trigger_event = { id = marcher.0105 days = 30 } }	# You get played like a cheap fiddle
			}
		}
        
        stress_impact = {
            content = minor_stress_impact_gain
            greedy = medium_stress_impact_gain
            content = minor_stress_impact_gain
        }
        
        ai_chance = {
            base = 100
            
            ai_value_modifier = {
                ai_greed = -0.5
                ai_boldness = 0.5
            }
            
            compare_modifier = { #Poor AI will be less likely to bankrupt itself further if not stupid
                trigger = {
                    AND = {
                        ai_rationality >= 10
                        short_term_gold <= 100
                    }
                }
                
                value = {
                    value = short_term_gold
                    add = -100
                }
            }
        }
	}
	
	option = { # Don't bother
		name = marcher.0103.b
		custom_tooltip = marcher.0103.b.tt
        
        stress_impact = {
            ambitious = medium_stress_impact_gain
        }
        
        ai_chance = {
            base = 100 # Default if modifiers for 0103.a bring it too low
        }
	}
}

marcher.0104 = { # Pet Griffon trained into a war mount
	title = marcher.0104.t
	desc = marcher.0104.desc
	theme = hunt_activity
	left_portrait = { 
		character = root
	}
	
	option = {	# War Griffon's yours
		name = marcher.0104.a
		hidden_effect = {
			remove_artifact = { ARTIFACT = artifact_mountgriffon }
		}
		add_artifact = { ARTIFACT = artifact_mountwargriffon }
	}
}

marcher.0105 = { # The trainer conned you
	title = marcher.0105.t
	desc = marcher.0105.desc
	theme = hunt_activity
	left_portrait = { 
		character = root
	}
	
	option = {	# You get nothing
		name = marcher.0105.a
	}
}

marcher.0110 = { # Be offered a griffon upon becoming High King of Chevalie
	title = marcher.0110.t
	desc = marcher.0110.desc
	theme = crown
	left_portrait = { 
		character = root
	}
	
	option = {	# Accept
		name = marcher.0110.a
		add_artifact = { ARTIFACT = artifact_mountgriffon }
        
        ai_chance = {
            base = 100
        }
	}
	
	option = {	# Decline
		name = marcher.0110.b
        
        stress_impact = {
            ambitious = medium_stress_impact_gain
        }
        
        ai_chance = {
            base = 0 #AI will never decline this
        }
	}
}

marcher.0115 = {   #person who holds the sword
	title = marcher.1150.t
	desc = marcher.1150.desc
	theme = stewardship
}

##################
# Marcher Random Griffon attack - OPENING
# Random chance of a griffon attack occuring, this then has a branching possible narrative (3 possible endings)
# marcher.1150-marcher.1170 (remove if not starting an event chain)
# marcher.1150
# A random province in your county is being menaced by a griffon!
# by Netgearghost
marcher.1150 = { #yearly pulse event for griffin menacing a province
	title = marcher.1150.t
	desc = marcher.1150.desc
	theme = stewardship
	left_portrait = {
		character = root
	}
	trigger = {
		culture_group = culture_group:gh_marcher_group
	}

	immediate = {
		random_sub_realm_county = {
			add_county_modifier = {
				modifier = gh_griffon_attack_modifier
				years = 4
			}
			save_scope_as = province_being_affected	
		}
	}

	option = {
		name = marcher.1150.a
		hidden_effect = {
			random_list = {
				34 = {
					trigger_event = {
						id = marcher.1155
						months = 6	
					}
				}
				33 = {
					trigger_event = {
						id = marcher.1165
						months = 6
					}
				}
				33 = {
					trigger_event = {
						id = marcher.1170
						months = 6
					}
				}
			}
		}
	}
	option = {
		name = marcher.1150.b
	}
}

# marcher.1155
# The griffon has been found! Figure out whats going on or attack it!
# by Netgearghost
marcher.1155 = {   #found the griffon, attack or figure out whats going on?
	title = marcher.1155.t
	desc = marcher.1155.desc
	theme = war
	left_portrait = {
		character = root
	}

	option = { # Try and figure out whats going on
		name = marcher.1155.a
		custom_tooltip = marcher.1155.a.tt

		remove_short_term_gold = medium_gold_value
		hidden_effect = {
			trigger_event = {
				id = marcher.1160
				months = 3
			}
		}
	}

	option = { # Kill the griffon :(
		name = marcher.1155.b
		custom_tooltip = marcher.1155.b.tt

		add_piety = minor_piety_loss
		duel = {
			skill = prowess
			value = 12
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 4
				}
				desc = marcher.1155.b.success
				add_martial_skill = 2
				add_prowess_skill = 2
				add_prestige = major_prestige_gain
				add_character_modifier = gh_slew_griffon_modifier
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1155.b.failure
				random_list = {
					65 = { add_trait = wounded_1 }
					20 = { add_trait = wounded_2 }
					10 = { add_trait = wounded_3 }
					5 = { death = { death_reason = death_battle } }
				}
				add_prestige = minor_prestige_loss
			}
		}
	}
}

# marcher.1160
# You have figured out what happened to the griffon, and why it was attacking the county
# by Netgearghost
marcher.1160 = {  #finding out what happened to the griffon
	title = marcher.1160.t
	desc = marcher.1160.desc
	theme = hunting
	left_portrait = {
		character = root
	}
	
	option = {
		name = marcher.1160.a
		add_prestige = minor_prestige_gain
		duel = {
			skill = diplomacy
			value = 12
			12 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 8
				}
				desc = marcher.1160.a.success
				add_prestige = major_prestige_gain
				add_artifact = { ARTIFACT = artifact_mountwargriffon }
			}
			15 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.b.success
				add_prestige = medium_prestige_gain
				add_trait = wounded_1
				add_artifact = { ARTIFACT = artifact_mountwargriffon }
				
			}
			15 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.c.failure
				add_prestige = minor_prestige_loss
				add_trait = wounded_1
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.d.failure
				add_prestige = minor_prestige_loss
			}
		}
		stress_impact = {
			craven = medium_stress_impact_gain
		}
	}

	option = {
		name = marcher.1160.b
		add_piety = major_piety_gain
		stress_impact = {
			brave = medium_stress_impact_gain
		}
	}
}

# marcher.1165
# It was not a griffon at all! Instead a group of rogue knights have attacked
# by Netgearghost
marcher.1165 = {    #Rogue knights alternative path
	title = marcher.1165.t
	desc = marcher.1165.desc
	theme = war
	left_portrait = {
		character = root
	}
   
	immediate = {
		hidden_effect = {
			create_character = {
				location = root.capital_province
				save_scope_as = duel_opponent
				trait = brave
				trait = wrathful
				culture = root.culture
				faith = root.faith
				gender_female_chance = root_soldier_female_chance
				prowess = 15
			}
		}
	}

	option = { # Fight the gang leader
		name = marcher.1165.a
		custom_tooltip = marcher.1165.a.tt
		
		duel = {
			skill = prowess
			value = 8
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 4
				}
				desc = marcher.1165.a.success
				add_prestige = medium_prestige_gain
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1165.a.failure
				random_list = {
					65 = { add_trait = wounded_1 }
					20 = { add_trait = wounded_2 }
					10 = { add_trait = wounded_3 }
					5 = { death = { death_reason = death_battle } }
				}
				add_prestige = minor_prestige_loss
				stress_impact = {
					brave = medium_stress_impact_loss
					craven = major_stress_impact_gain
				}
			}
		}
	}	

	option = { # pay off the gang leader
		name = marcher.1165.b
		custom_tooltip = marcher.1165.b.tt

		add_prestige = medium_prestige_loss
		remove_short_term_gold = major_gold_value
		stress_impact = {
			brave = medium_stress_impact_gain
			greedy = major_stress_impact_gain
		}
	}

	option = {
		name = marcher.1165.c

		duel = {
			skill = diplomacy
			value = 12
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 4
				}
				desc = marcher.1165.c.success
				add_prestige = medium_prestige_gain
				add_courtier = scope:duel_opponent
				reverse_add_opinion = {
					modifier = duel_mutual_respect_opinion
					target = scope:duel_opponent
				}
				add_opinion = {
					modifier = duel_mutual_respect_opinion
					target = scope:duel_opponent
				}
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1165.c.failure
				random_list = {
					75 = { add_trait = maimed }
					20 = { add_trait = wounded_3 }
					5 = { death = { death_reason = death_battle } }
				}
				add_prestige = minor_prestige_loss
			}
		}
	}
}

# marcher.1170
# Fight to tame the griffon or to slay it!
# by Netgearghost
marcher.1170 = {
	title = marcher.1170.t
	desc = marcher.1170.desc
	theme = war
	left_portrait = {
		character = root
	}

	option = {
		name = marcher.1170.a

		add_prestige = major_prestige_gain
	}

	option = {   #diplo check to tame griffon
		name = marcher.1170.b
		add_prestige = minor_prestige_gain
		duel = {
			skill = diplomacy
			value = 12
			12 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 8
				}
				desc = marcher.1160.a.success
				add_prestige = major_prestige_gain
				add_artifact = { ARTIFACT = artifact_mountwargriffon }
			}
			15 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.b.success
				add_prestige = medium_prestige_gain
				add_trait = wounded_1
				add_artifact = { ARTIFACT = artifact_mountwargriffon }
				
			}
			15 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.c.failure
				add_prestige = minor_prestige_loss
				add_trait = wounded_1
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1160.d.failure
				add_prestige = minor_prestige_loss
			}
		}
		stress_impact = {
			craven = medium_stress_impact_gain
		}
	}

	option = { # fight the griffon off
		name = marcher.1170.c
		custom_tooltip = marcher.1170.c.tt
		
		duel = {
			skill = prowess
			value = 8
			10 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 4
				}
				desc = marcher.1170.a.success
				add_prestige = massive_prestige_gain
			}
			20 = {
				compare_modifier = {
					value = scope:duel_value
				}
				desc = marcher.1170.a.failure
				random_list = {
					65 = { add_trait = wounded_1 }
					20 = { add_trait = wounded_2 }
					10 = { add_trait = wounded_3 }
					5 = { death = { death_reason = death_battle } }
				}
				add_prestige = minor_prestige_loss
				stress_impact = {
					brave = medium_stress_impact_loss
					craven = major_stress_impact_gain
				}
			}
		}
	}
}