###Magic Point Generation###

sacrifice_population = {
	scope = character


    effect = {
		if = {
			limit = { 
				root = { 
					has_variable_list = spell_l_targets
					any_in_list = {
						variable = spell_l_targets
						holder = root
					}
				}
			}
			root = { trigger_event = magic.2601 }
			custom_tooltip = sacrifice_population.tt
		}
    }
}

flagellate = {
	scope = character

	effect = {
		flagellate_effect = yes
	}
}

ritual_sacrifice = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					has_variable_list = spell_targets
					any_in_list = {
						variable = spell_targets
						is_imprisoned_by = root
					}
				}
			}
			custom_tooltip = will_mass_sacrifice_tt
			root = { trigger_event = magic.0001 }
		}
    }
}

ritual_consumption = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					has_variable_list = spell_targets
					any_in_list = {
						variable = spell_targets
						is_imprisoned_by = root
					}
				}
			}
			custom_tooltip = will_ritually_consume_tt
			root = { trigger_event = magic.0002 }
		}
    }
}

# actual sacrifice_plants_effect can be found in gh_magic_spell_effects

sacrifice_plants = {
	scope = character


    effect = {
		if = {
			limit = { 
				root = { 
					has_variable_list = spell_l_targets
					any_in_list = {
						variable = spell_l_targets
						holder = root
					}
				}
			}
			root = { trigger_event = magic.0021 }
			custom_tooltip = sacrifice_plants.tt
		}
    }
}

communed_with_the_way = {
	scope = character

    effect = {
        change_variable = {
    		name = magic_counter
    		add = tier_2_gen
    	}

    	add_character_flag = {
    		flag = communed_with_the_way
    		years = 10
    	}
        if = {
            limit = {
                root = {
                    has_perk = livingmagic_perk2_tree1
                }
            }
            generate_prowess_or_intrigue = yes
        }
        if = {
            limit = {
                root = {
                    has_perk = livingmagic_perk6_tree1
                }
            }
            add_stress = medium_stress_loss
        }
    }
}

channel_the_rift = {
    scope = character

    effect = {
        trigger_event = magic.2500
    }
}

communed_with_eldritch = {
    scope = character

    effect = {
        change_variable = {
            name = magic_counter
            add = tier_3_gen
        }
        add_character_flag = {
            flag = communes_with_eldritch
            years = 10
        }
        if = {
            limit = {
                root = {
                    has_perk = mixedmagic_perk4_tree1
                }
            }
            add_stress = medium_stress_gain
        }
        else = {
            add_stress = major_stress_gain
        }

    }
}

dreamwalk = {
    scope = character

    effect = {
        change_variable = {
            name = magic_counter
            add = tier_2_gen
        }
        add_character_flag = {
            flag = dreamwalked
            years = 5
        }
        if = {
            limit = {
                root = {
                    has_perk = mixedmagic_perk3_tree1
                }
            }
            add_stress = minor_stress_gain
        }
        else = {
            add_stress = medium_stress_gain
        }

        if = {
            limit = {
                root = {
                    has_perk = mixedmagic_perk3_tree3
                }
            }
            hidden_effect = {
                thought_theft_effect = yes
            }
        }
    }
}

dream_invasion = {
    scope = character

    effect = {
        if = {
            limit = {
                root = {
                    has_variable_list = spell_targets
                }
            }
            every_in_list = {
                variable = spell_targets
                custom_tooltip = dream_invasion.tt
                add_character_modifier = {
                    modifier = has_nightmares
                    years = 5
                }
            }
            root = {
                add_character_flag = {
                    flag = dream_invaded
                    years = 10
                }

                change_variable = {
                    name = magic_counter
                    add = tier_2_gen
                }
            }
        }
        else = {

        }
    }
}

ethereal_ritual = {
    scope = character

    effect = {
        change_variable = {
            name = magic_counter
            add = tier_2_gen
        }
        add_character_flag = {
            flag = communes_with_ethereals
            years = 5
        }
        if = {
            limit = {
                root = {
                    has_perk = mixedmagic_perk4_tree1
                }
            }
            add_stress = medium_stress_gain
        }
        else = {
            add_stress = major_stress_gain
        }

    }
}

skeletal_craft = {
    scope = character

    effect = {
        trigger_event = bonecrafting.0001
		custom_tooltip = skeletal_crafting.tt
    }    
}

moon_pull = { 
    scope = character

    effect = {
		custom_tooltip = moon_pull_1.tt
		custom_tooltip = moon_pull_2.tt
        if = {
			limit = {
				has_character_modifier = pulling_moon_mod
				}
				remove_character_modifier =  pulling_moon_mod
			}
		else = {
			add_character_modifier = {
				modifier = pulling_moon_mod
			}
		}
    }
}

study_arcane = {
    scope = character

    effect = {
        change_variable = {
            name = magic_counter
            add = tier_1_gen
        }

        add_character_flag = {
            flag = studied_arcane
            years = 20
        }
    }
}

expedition = {
    scope = character

    effect = {
        change_variable = {
            name = magic_counter
            add = tier_5_gen
        }

        add_character_flag = {
            flag = went_on_expedition
            years = 5
        }		
    }
}