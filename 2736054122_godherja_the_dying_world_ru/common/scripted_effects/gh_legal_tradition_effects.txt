###########################
# LEGAL TRADITION EFFECTS #
###########################

##################
# INITIALIZATION #
##################

initialize_legal_traditions_effect = {
	# First, initialize legal tradition trait and trait categories
	legal_tradition_trait_effect = { MODE = initialize }
	
	# Then, initialize the traditions themselves
	
	## MAINLINE TRADITIONS
	create_legal_tradition_effect = { NAME = tashbari LEVEL = 3 }
	scope:tashbari = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach TRAIT = metaphorialist 	RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = epistemology  			TRAIT = emotionalist 	RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness 				TRAIT = liberal 		RANK = 2 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = abajjarmia_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reformed_radicals }
		
		set_legal_tradition_founder_effect = { FOUNDER = character:mamuramat_6 }
		set_legal_tradition_founding_century_effect = { CENTURY = 9 }
		add_historical_legal_tradition_major_patron_effect = { YEAR = 900 PATRON = character:mamuramat_6 }
		
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	create_legal_tradition_effect = { NAME = babatadi LEVEL = 3 }
	scope:babatadi = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach TRAIT = literalist 		RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity  	TRAIT = broad 			RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 				TRAIT = hierarchical 	RANK = 2 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = age_of_ink_and_gold }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = mamurial_creation }
		
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	create_legal_tradition_effect = { NAME = zaydeni LEVEL = 4 }
	scope:zaydeni = {
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity  	TRAIT = narrow 		RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = epistemology  			TRAIT = rationalist RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 				TRAIT = egalitarian RANK = 3 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = the_establishment }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = pioneering_judge }
		
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	create_legal_tradition_effect = { NAME = maridai LEVEL = 1 }
	scope:maridai = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach TRAIT = metaphorialist 	RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = epistemology  			TRAIT = emotionalist 	RANK = 1 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 				TRAIT = egalitarian 	RANK = 4 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = era_of_dissent }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reform_movement }
		
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	create_legal_tradition_effect = { NAME = atarni LEVEL = 0 }
	scope:atarni = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 	TRAIT = literalist 	RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus  			TRAIT = agrarian 	RANK = 1 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness 					TRAIT = draconian 	RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = era_of_dissent }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reform_movement }
		
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	generate_procedural_legal_tradition_effect = { LEVEL = 0 TRAIT_POINTS = 4 }
	scope:created_legal_tradition = {
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	generate_procedural_legal_tradition_effect = { LEVEL = 0 TRAIT_POINTS = 4 }
	scope:created_legal_tradition = {
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	generate_procedural_legal_tradition_effect = { LEVEL = 0 TRAIT_POINTS = 4 }
	scope:created_legal_tradition = {
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = central_high_court }
	}
	
	## IDEALIST TRADITIONS
	create_legal_tradition_effect = { NAME = ruthamari LEVEL = 4 }
	scope:ruthamari = {
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 		TRAIT = broad 		RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus  			TRAIT = urbanite 	RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness 					TRAIT = liberal 	RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = age_of_ink_and_gold }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reform_movement }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 7 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = idealist_high_court }
	}
	
	create_legal_tradition_effect = { NAME = narabiqi LEVEL = 2 }
	scope:narabiqi = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 	TRAIT = metaphorialist 	RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = classism  		TRAIT = egalitarian RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus 	TRAIT = agrarian 	RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = era_of_dissent }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = pioneering_judge }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 12 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = idealist_high_court }
	}
	
	create_legal_tradition_effect = { NAME = tarthari LEVEL = 3 }
	scope:tarthari = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 	TRAIT = literalist 		RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = classism  		TRAIT = egalitarian RANK = 1 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus 	TRAIT = urbanite 	RANK = 3 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = era_of_dissent }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = rebellious_magistrates }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 12 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = idealist_high_court }
	}
	
	create_legal_tradition_effect = { NAME = kedbarki LEVEL = 3 }
	scope:kedbarki = {
		set_legal_tradition_trait_effect = { CATEGORY = harshness 		TRAIT = draconian 	 RANK = 1 }
		set_legal_tradition_trait_effect = { CATEGORY = belligerence  	TRAIT = warlike 	 RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 		TRAIT = literalist RANK = 3 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = age_of_tathtali }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = rebellious_magistrates }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 9 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = idealist_high_court }
	}
	
	create_legal_tradition_effect = { NAME = hasani LEVEL = 1 }
	scope:hasani = {
		set_legal_tradition_trait_effect = { CATEGORY = classism 		TRAIT = egalitarian  RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach  	TRAIT = literalist 	 	 RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus 	TRAIT = urbanite 	 RANK = 2 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = era_of_dissent }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reformed_radicals }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 12 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = idealist_high_court }
	}
	
	## TRADITIONALIST TRADITIONS
	create_legal_tradition_effect = { NAME = thabiti LEVEL = 3 }
	scope:thabiti = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 	TRAIT = metaphorialist 	 RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = classism  		TRAIT = hierarchical RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 	TRAIT = narrow RANK = 2 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = traditional_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = mamurial_creation }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 6 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = eastern_high_court }
	}
	
	create_legal_tradition_effect = { NAME = misria LEVEL = 3 }
	scope:misria = {
		set_legal_tradition_trait_effect = { CATEGORY = special 		TRAIT = mysticistic  RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach  	TRAIT = metaphorialist 	 RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = hierarchical 	TRAIT = egalitarian  RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = traditional_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = unknown_origin }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 6 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = western_high_court }
	}
	
	create_legal_tradition_effect = { NAME = ajari LEVEL = 5 }
	scope:ajari = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach  	TRAIT = literalist 	 	 RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = hierarchical 	TRAIT = egalitarian  RANK = 1 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 		TRAIT = narrow RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = the_great_uprising }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = rebellious_magistrates }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 4 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = eastern_high_court }
	}
	
	create_legal_tradition_effect = { NAME = alshammi LEVEL = 3 }
	scope:alshammi = {
		set_legal_tradition_trait_effect = { CATEGORY = belligerence 	TRAIT = warlike  	 RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 		TRAIT = broad RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach  	TRAIT = literalist 	 	 RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = the_great_uprising }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = mamurial_creation }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 4 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = far_eastern_high_court }
	}
	
	create_legal_tradition_effect = { NAME = kurushi LEVEL = 3 }
	scope:kurushi = {
		set_legal_tradition_trait_effect = { CATEGORY = belligerence 	TRAIT = warlike  	 RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = epistemology 	TRAIT = rationalist  RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach  	TRAIT = literalist 	 	 RANK = 2 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = traditional_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = scholastic_resistance }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 7 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = western_high_court }
	}
	
	create_legal_tradition_effect = { NAME = mabruki LEVEL = 3 }
	scope:mabruki = {
		set_legal_tradition_trait_effect = { CATEGORY = classism 		TRAIT = egalitarian  RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus 	TRAIT = urbanite  	 RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity  	TRAIT = broad RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = the_establishment }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = rebellious_magistrates }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 5 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = eastern_high_court }
	}
	
	create_legal_tradition_effect = { NAME = hathali LEVEL = 4 }
	scope:hathali = {
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach 	TRAIT = literalist  		 RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 		TRAIT = egalitarian  RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness  		TRAIT = draconian 	 RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = the_establishment }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = rebellious_magistrates }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 5 }
		assign_legal_tradition_to_high_court_effect = { HIGH_COURT = eastern_high_court }
	}
	
	## RADICAL TRADITIONS
	create_legal_tradition_effect = { NAME = zubatai LEVEL = 3 }
	scope:zubatai = {
		set_legal_tradition_trait_effect = { CATEGORY = belligerence 	TRAIT = pacifistic 	RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus  TRAIT = agrarian 	RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 		TRAIT = egalitarian RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = abajjarmia_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = unknown_origin }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 9 }
		assign_legal_tradition_to_religion_effect = { RELIGION = religion:sarradonian_religion }
	}
	
	create_legal_tradition_effect = { NAME = qatirri LEVEL = 2 }
	scope:qatirri = {
		set_legal_tradition_trait_effect = { CATEGORY = belligerence 	TRAIT = warlike 	 RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness  		TRAIT = draconian 	 RANK = 4 }
		set_legal_tradition_trait_effect = { CATEGORY = epistemology 	TRAIT = emotionalist RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = age_of_tathtali }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = warlord_innovation }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 9 }
		assign_legal_tradition_to_religion_effect = { RELIGION = religion:sarradonian_religion }
	}
	
	create_legal_tradition_effect = { NAME = tawatasi LEVEL = 4 }
	scope:tawatasi = {
		set_legal_tradition_trait_effect = { CATEGORY = economic_focus 	TRAIT = agrarian 	 RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = classism  		TRAIT = egalitarian  RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 	TRAIT = broad RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = abajjarmia_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = folk_movement }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 10 }
		assign_legal_tradition_to_religion_effect = { RELIGION = religion:sarradonian_religion }
	}
	
	create_legal_tradition_effect = { NAME = minbiri LEVEL = 3 }
	scope:minbiri = {
		set_legal_tradition_trait_effect = { CATEGORY = harshness 	TRAIT = liberal 		RANK = 5 }
		set_legal_tradition_trait_effect = { CATEGORY = interpretative_approach TRAIT = metaphorialist 		RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = classism 	TRAIT = egalitarian 	RANK = 1 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = traditional_golden_age }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = unknown_origin }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 6 }
		assign_legal_tradition_to_religion_effect = { RELIGION = religion:sarradonian_religion }
	}
	
	create_legal_tradition_effect = { NAME = hayashi LEVEL = 1 }
	scope:hayashi = {
		set_legal_tradition_trait_effect = { CATEGORY = scriptural_diversity 	TRAIT = narrow 	RANK = 2 }
		set_legal_tradition_trait_effect = { CATEGORY = harshness 	TRAIT = draconian 		RANK = 3 }
		set_legal_tradition_trait_effect = { CATEGORY = belligerence TRAIT = warlike 		RANK = 5 }
		
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = modern_era }
		set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = warlord_innovation }
		
		set_legal_tradition_founding_century_effect = { CENTURY = 13 }
		assign_legal_tradition_to_religion_effect = { RELIGION = religion:sarradonian_religion }
	}
}

##########
# TRAITS #
##########

legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_effect = { TRAIT = metaphorialist 			CATEGORY = interpretative_approach }
	$MODE$_legal_tradition_trait_effect = { TRAIT = literalist 				CATEGORY = interpretative_approach }
	$MODE$_legal_tradition_trait_effect = { TRAIT = rationalist 			CATEGORY = epistemology }
	$MODE$_legal_tradition_trait_effect = { TRAIT = emotionalist 			CATEGORY = epistemology }
	$MODE$_legal_tradition_trait_effect = { TRAIT = broad					CATEGORY = scriptural_diversity }
	$MODE$_legal_tradition_trait_effect = { TRAIT = narrow 					CATEGORY = scriptural_diversity }
	$MODE$_legal_tradition_trait_effect = { TRAIT = liberal 				CATEGORY = harshness }
	$MODE$_legal_tradition_trait_effect = { TRAIT = draconian 				CATEGORY = harshness }
	$MODE$_legal_tradition_trait_effect = { TRAIT = egalitarian 			CATEGORY = classism }
	$MODE$_legal_tradition_trait_effect = { TRAIT = hierarchical 			CATEGORY = classism }
	$MODE$_legal_tradition_trait_effect = { TRAIT = warlike 				CATEGORY = belligerence }
	$MODE$_legal_tradition_trait_effect = { TRAIT = pacifistic 				CATEGORY = belligerence }
	$MODE$_legal_tradition_trait_effect = { TRAIT = agrarian 				CATEGORY = economic_focus }
	$MODE$_legal_tradition_trait_effect = { TRAIT = urbanite 				CATEGORY = economic_focus }
	$MODE$_legal_tradition_trait_effect = { TRAIT = mysticistic 			CATEGORY = special }
}

#######################
# TRAIT EFFECTS TABLE #
#######################

metaphorialist_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = cynical_gives_judicial_power 			LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = scholar_gives_judicial_power 			LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = can_justify_claims 					LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = learning_gives_double_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = stronger_offensive_judicial_power		LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = {  TRAIT = metaphorialist FLAG = random_bonus_legal_rewards			LEVEL = 5 }
}

literalist_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = zealous_gives_judicial_power				LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = theologian_gives_judicial_power 			LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = can_censure_sinful_characters			LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = each_virtue_increases_judicial_power		LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = piety_level_gives_judicial_power			LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = can_disinherit_sinful_characters_with_piety	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = literalist FLAG = can_censure_less_virtuous_characters		LEVEL = 5 }
}

rationalist_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = calm_gives_judicial_power	 							LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = patient_gives_judicial_power 							LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = cultural_head_fascination_mult_from_tradition_modifier 	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = learning_boosts_piety_gain_from_trials 					LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = radicalism_gives_judicial_power							LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = participating_in_legal_action_can_give_learning 		LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = rationalist FLAG = learning_per_piety_level_from_tradition_modifier 		LEVEL = 5 }
}

emotionalist_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = impatient_gives_judicial_power	 	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = wrathful_gives_judicial_power	 	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = diplomacy_from_tradition_modifier 	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = diplomacy_gives_judicial_power		LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = prestige_from_tradition_modifier 	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = emotionalist FLAG = diplomacy_per_prestige_level_from_tradition_modifier 	LEVEL = 5 }
}

broad_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = broad FLAG = each_level_increases_difficulty_and_rewards	 LEVEL = 1 }
}

narrow_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = narrow FLAG = each_level_decreases_difficulty	 LEVEL = 1 }
}

liberal_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = forgiving_gives_judicial_power							LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = compassionate_gives_judicial_power						LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = popular_opinion_from_tradition_modifier					LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = medium_stress_gain_reduction_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = diplomacy_gives_judicial_power							LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = vassal_opinion_from_tradition_modifier					LEVEL = 4 }
	#$MODE$_legal_tradition_trait_flag_effect = { TRAIT = liberal FLAG = can_exchange_imprisonment_reasons_for_piety				LEVEL = 5 }
}

draconian_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = vengeful_gives_judicial_power				LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = sadistic_gives_judicial_power				LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = censured_characters_can_be_imprisoned		LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = control_growth_from_tradition_modifier	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = tyranny_gain_reduction_from_tradition_modifier	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = draconian FLAG = crimes_allow_any_punishment				LEVEL = 5 }
}

egalitarian_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = humble_gives_judicial_power				LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = content_gives_judicial_power			LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = apolitical_suits_give_better_rewards	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = diplomacy_gives_judicial_power			LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = can_designate_heir						LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = egalitarian FLAG = can_depose_vassals						LEVEL = 5 }
}

hierarchical_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = arrogant_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = ambitious_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = vassal_tax_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = renown_level_gives_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = vassal_contribution_from_tradition_modifier LEVEL = 4 }
	#$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = can_designate_heir					LEVEL = 4 }
	#$MODE$_legal_tradition_trait_flag_effect = { TRAIT = hierarchical FLAG = can_designate_vassal_heirs			LEVEL = 5 }
}

warlike_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = warlike FLAG = wrathful_gives_judicial_power	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = warlike FLAG = impatient_gives_judicial_power	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = warlike FLAG = knight_effectiveness_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = warlike FLAG = martial_gives_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = warlike FLAG = martial_per_piety_from_tradition_modifier	LEVEL = 4 }
}

pacifistic_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = calm_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = patient_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = development_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = diplomacy_gives_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = vassal_opinion_from_tradition_modifier	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = pacifistic FLAG = domain_limit_from_tradition_modifier	LEVEL = 5 }
}

agrarian_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = diligent_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = overseer_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = development_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = stewardship_gives_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = domain_tax_mult_from_tradition_modifier	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = agrarian FLAG = domain_limit_from_tradition_modifier	LEVEL = 5 }
}

urbanite_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = greedy_gives_judicial_power			LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = avaricious_gives_judicial_power		LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = development_from_tradition_modifier	LEVEL = 2 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = stewardship_gives_judicial_power	LEVEL = 3 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = domain_tax_mult_from_tradition_modifier	LEVEL = 4 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = urbanite FLAG = domain_limit_from_tradition_modifier	LEVEL = 5 }
}

mysticistic_legal_tradition_trait_effect = {
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = mysticistic FLAG = mystic_gives_judicial_power	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = mysticistic FLAG = mystic_increases_piety_reward	LEVEL = 1 }
	$MODE$_legal_tradition_trait_flag_effect = { TRAIT = mysticistic FLAG = may_gain_mystic_from_trials	LEVEL = 1 }
}

##########################
# MODIFIERS EFFECT TABLE #
##########################

legal_tradition_modifier_effect = {
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = medium_stress_gain_reduction_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = popular_opinion_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = vassal_tax_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = cultural_head_fascination_mult_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = learning_per_piety_level_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = diplomacy_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = control_growth_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = tyranny_gain_reduction_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = prestige_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = diplomacy_per_prestige_level_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = vassal_opinion_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = development_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = domain_tax_mult_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = domain_limit_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = knight_effectiveness_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = vassal_contribution_from_tradition_modifier }
	$MODE$_legal_tradition_modifier_effect = { MODIFIER = martial_per_piety_from_tradition_modifier }
}

#############################
# TRADITION BACKEND EFFECTS #
#############################

# Global effect that does tradition-related maintenance
update_global_legal_tradition_information_effect = {
	every_in_global_list = {
		variable = all_traditions
		every_in_list = {
			variable = legal_tradition_patrons
			add_legal_tradition_progress_from_patron_effect = yes
		}
	}
}

# Create a legal tradition
create_legal_tradition_effect = {
	# At the very start, we reserve a random province to act as the storage for the legal tradition
	random_province = {
		limit = { 
			NOT = { has_variable = legal_tradition_name } 
		}
		save_temporary_scope_as = legal_tradition_storage_province
		save_scope_as = created_legal_tradition
		add_to_global_variable_list = {
			name = all_traditions
			target = scope:legal_tradition_storage_province
		}
	}
	# We check the exact nature of the name parameter. If it is an existent scope, we use that character as a holder for the name (this is the case with custom schools)
	# Else, we create one such character and give them the passed parameter as a name
	if = {
		limit = { exists = scope:$NAME$ }
		scope:legal_tradition_storage_province = {
			set_variable = {
				name = legal_tradition_name
				value = scope:$NAME$
			}
		}
	}
	else = {
		# Prescripted legal traditions are assigned a unique flag, which allows for things like custom descriptions
		scope:legal_tradition_storage_province = {
			set_variable = {
				name = prescripted_legal_tradition_flag
				value = flag:$NAME$
			}
		}
		create_character = {
			save_temporary_scope_as = tradition_name_storage_character
			name = NAME_NOT_SET
			gender = male
			age = 20
			faith = title:c_halium.faith
			culture = title:c_halium.culture
			location = title:c_halium.title_province
		}
		# Kill this person, because we literally only need them to hold the name string and they suit that purpose just as fine being dead
		scope:tradition_name_storage_character = {
			change_first_name = flag:$NAME$_name
			death = {
				death_reason = death_hunting_accident
			}
			make_unprunable = yes
		}
		scope:legal_tradition_storage_province = {
			set_variable = {
				name = legal_tradition_name
				value = scope:tradition_name_storage_character
			}
		}
	}
	scope:legal_tradition_storage_province = {
		save_scope_as = $NAME$
		set_variable = {
			name = legal_tradition_level
			value = $LEVEL$
		}
		# Set the tradition's progress towards the next level to 0
		set_variable = {
			name = legal_tradition_level_progress
			value = 0
		}
	}
}

# Delete a legal tradition
delete_legal_tradition_effect = {
	# For the moment, we don't actually free up the province being used for the legal tradition for ease of use
	# This shouldn't cause any serious bloat
	save_temporary_scope_as = delete_legal_tradition_tradition_to_delete_scope
	every_in_global_list = {
		variable = global_high_court_list
		limit = { 
			has_variable_list = legal_traditions
			any_in_list = {
				variable = legal_traditions
				this = scope:delete_legal_tradition_tradition_to_delete_scope
			}
		}
		remove_list_variable = {
			name = legal_traditions
			target = scope:delete_legal_tradition_tradition_to_delete_scope
		}
	}
}

# Generate a procedural legal tradition
generate_procedural_legal_tradition_effect = {
	create_character = {
		save_temporary_scope_as = tradition_name
		name = NAME_NOT_SET
		age = 20
		gender = male
		faith = title:c_halium.faith
		culture = title:c_halium.culture
		location = title:c_halium.title_province
	}
	# Used in loc, do not remove
	random_living_character = {
		limit = { religion = religion:sarradonian_religion }
		set_global_variable = {
			name = tradition_namesake_scope
			value = this
		}
	}
	scope:tradition_name = {
		death = {
			death_reason = death_hunting_accident
		}
		change_first_name = GENERATED_TRADITION_NAME
		make_unprunable = yes
	}
	
	create_legal_tradition_effect = { NAME = tradition_name LEVEL = $LEVEL$ }
	scope:created_legal_tradition = {
		legal_tradition_trait_effect = { MODE = assemble_tombola }
		set_variable = {
			name = remaining_category_picks
			value = 3
		}
		set_variable = {
			name = remaining_trait_points
			value = $TRAIT_POINTS$
		}
		random_in_list = {
			list = possible_legal_tradition_categories
			save_temporary_scope_as = picked_category
			remove_from_list = possible_legal_tradition_categories
		}
		legal_tradition_trait_effect = { MODE = set_generation }
		random_in_list = {
			list = possible_legal_tradition_categories
			save_temporary_scope_as = picked_category
			remove_from_list = possible_legal_tradition_categories
		}
		legal_tradition_trait_effect = { MODE = set_generation }
		random_in_list = {
			list = possible_legal_tradition_categories
			save_temporary_scope_as = picked_category
			remove_from_list = possible_legal_tradition_categories
		}
		legal_tradition_trait_effect = { MODE = set_generation }
		clear_local_variable_list = possible_legal_tradition_categories
		remove_variable = remaining_category_picks
		remove_variable = remaining_trait_points
		set_legal_tradition_trait_unranked_effect = { CATEGORY = founding_era 	TRAIT = modern_era }
		random_list = {
			2 = {
				set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = mamurial_creation }
			}
			5 = {
				set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = pioneering_judge }
			}
			3 = {
				set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = reform_movement }
			}
			1 = {
				set_legal_tradition_trait_unranked_effect = { CATEGORY = origin 		TRAIT = folk_movement }
			}
		}
	}
}

# Assign a legal tradition to a High Court
assign_legal_tradition_to_high_court_effect = {
	save_temporary_scope_as = legal_tradition_to_assign
	if = {
		limit = { exists = scope:$HIGH_COURT$ }
		scope:$HIGH_COURT$ = {
			add_to_variable_list = {
				name = legal_traditions
				target = scope:legal_tradition_to_assign
			}
		}
	}
	else_if = {
		limit = {
			any_in_global_list = {
				variable = global_high_court_list
				has_variable = high_court_name
				var:high_court_name = flag:$HIGH_COURT$
			}
		}
		random_in_global_list = {
			variable = global_high_court_list
			limit = {
				has_variable = high_court_name
				var:high_court_name = flag:$HIGH_COURT$
			}
			add_to_variable_list = {
				name = legal_traditions
				target = scope:legal_tradition_to_assign
			}
		}
	}
}

# Assign a legal tradition to a religion
assign_legal_tradition_to_religion_effect = {
	save_temporary_scope_as = legal_tradition_to_assign
	if = {
		limit = { exists = $RELIGION$ }
		$RELIGION$ = {
			add_to_variable_list = {
				name = legal_traditions
				target = scope:legal_tradition_to_assign
			}
		}
		set_variable = radical_tradition
	}
}

join_legal_tradition_effect = {
	if = {
		limit = {
			has_variable = character_legal_tradition
			NOT = { var:character_legal_tradition = $LEGAL_TRADITION$ }
		}
		leave_legal_tradition_effect = yes
	}
	custom_description = {
		text = "adopt_legal_tradition_effect"
		subject = this
		object = $LEGAL_TRADITION$
			
		set_variable = {
			name = character_legal_tradition
			value = $LEGAL_TRADITION$
		}
		set_variable = {
			name = legal_tradition_change_cooldown
			days = 1850
		}
		if = {
			limit = { NOT = { has_variable = current_jurist_level } }
			set_variable = {
				name = jurist_level_progress
				value = 0
			}
		}
	}
	hidden_effect = {
		# Assign modifiers
		legal_tradition_modifier_effect = { MODE = set_valid }
	}
}

leave_legal_tradition_effect = {
	if = {
		limit = { exists = var:character_legal_tradition }
		custom_description = {
			text = "leave_legal_tradition_effect"
			subject = this
			object = var:character_legal_tradition
			
			remove_variable = character_legal_tradition
			remove_variable = character_legal_tradition_patronage_level
			update_legal_tradition_patronage_modifier_effect = yes
		}
		# Clear modifiers
		hidden_effect = {
			legal_tradition_modifier_effect = { MODE = remove }
		}
	}
}

###################################
# TRADITION TRAIT BACKEND EFFECTS #
###################################

# Assigns a trait to a legal tradition
set_legal_tradition_trait_effect = {
	set_variable = {
		name = $CATEGORY$
		value = flag:$TRAIT$
	}
	add_to_variable_list = {
		name = active_legal_tradition_trait_categories
		target = flag:$CATEGORY$
	}
	set_variable = {
		name = $TRAIT$_rank
		value = $RANK$
	}
	$TRAIT$_legal_tradition_trait_effect = { MODE = set }
}

# Assigns a trait to a legal tradition during procedural generation
set_generation_legal_tradition_trait_effect = {
	if = {
		limit = {
			exists = scope:picked_category
			scope:picked_category = flag:$CATEGORY$
			exists = local_var:$CATEGORY$_trait
			local_var:$CATEGORY$_trait = flag:$TRAIT$
		}
		set_variable = {
			name = $CATEGORY$
			value = flag:$TRAIT$
		}
		add_to_variable_list = {
			name = active_legal_tradition_trait_categories
			target = flag:$CATEGORY$
		}
		if = {
			limit = {
				exists = var:remaining_category_picks
				exists = var:remaining_trait_points
				var:remaining_category_picks = 1
			}
			set_variable = {
				name = $TRAIT$_rank
				value = var:remaining_trait_points
			}
			change_variable = {
				name = $TRAIT$_rank
				add = 1
			}
		}
		else_if = {
			limit = {
				exists = var:remaining_trait_points
				var:remaining_trait_points < 1
			}
			set_variable = {
				name = $TRAIT$_rank
				value = 1
			}
		}
		else_if = {
			limit = {
				exists = var:remaining_trait_points
			}
			random_list = {
				10 = {
					set_variable = {
						name = $TRAIT$_rank
						value = 1
					}
				}
				20 = {
					trigger = {
						var:remaining_trait_points >= 1
					}
					set_variable = {
						name = $TRAIT$_rank
						value = 2
					}
					change_variable = {
						name = remaining_trait_points
						subtract = 1
					}
				}
				20 = {
					trigger = {
						var:remaining_trait_points >= 2
					}
					set_variable = {
						name = $TRAIT$_rank
						value = 3
					}
					change_variable = {
						name = remaining_trait_points
						subtract = 2
					}
				}
				10 = {
					trigger = {
						var:remaining_trait_points >= 3
					}
					set_variable = {
						name = $TRAIT$_rank
						value = 4
					}
					change_variable = {
						name = remaining_trait_points
						subtract = 3
					}
				}
				5 = {
					trigger = {
						var:remaining_trait_points >= 4
					}
					set_variable = {
						name = $TRAIT$_rank
						value = 5
					}
					change_variable = {
						name = remaining_trait_points
						subtract = 4
					}
				}
			}
		}
		else = {
			set_variable = {
				name = $TRAIT$_rank
				value = 1
			}
		}
		change_variable = {
			name = remaining_category_picks
			subtract = 1
		}
		$TRAIT$_legal_tradition_trait_effect = { MODE = set }
	}
}

# Assigns a trait to a legal tradition, for unranked traits
set_legal_tradition_trait_unranked_effect = {
	set_variable = {
		name = $CATEGORY$
		value = flag:$TRAIT$
	}
}

# Initializes possible legal school trait categories into a global list
# Since legal tradition categories are a complex object (we must also remember possible values) they will be stored in provinces
initialize_legal_tradition_trait_effect = {
	# If the category isn't already in the database, add it. Otherwise, just add the trait flag into the list of category traits
	if = {
		limit = {
			NOT = {
				any_in_global_list = {
					variable = all_legal_tradition_trait_categories
					has_variable = legal_tradition_trait_category_name
					var:legal_tradition_trait_category_name = flag:$CATEGORY$
				}
			}
		}
		random_province = {
			limit = { 
				NOT = { has_variable = legal_tradition_trait_category_name } 
			}
			set_variable = {
				name = legal_tradition_trait_category_name
				value = flag:$CATEGORY$
			}
			save_temporary_scope_as = legal_tradition_trait_category_storage_province
			add_to_global_variable_list = {
				name = all_legal_tradition_trait_categories
				target = scope:legal_tradition_trait_category_storage_province
			}
		}
	}
	else = {
		random_in_global_list = {
			variable = all_legal_tradition_trait_categories
			limit = {
				has_variable = legal_tradition_trait_category_name
				var:legal_tradition_trait_category_name = flag:$CATEGORY$
			}
			save_temporary_scope_as = legal_tradition_trait_category_storage_province
		}
	}
	scope:legal_tradition_trait_category_storage_province = {
		add_to_variable_list = {
			name = legal_tradition_category_traits
			target = flag:$TRAIT$
		}
	}
}

assemble_tombola_legal_tradition_trait_effect = {
	flag:$CATEGORY$ = { add_to_list = possible_legal_tradition_categories }
	if = {
		limit = { NOT = { exists = local_var:$CATEGORY$_trait } }
		set_local_variable = {
			name = $CATEGORY$_trait
			value = flag:$TRAIT$
		}
	}
	else = {
		random = {
			chance = 50
			set_local_variable = {
				name = $CATEGORY$_trait
				value = flag:$TRAIT$
			}
		}
	}
}

effect_tooltip_legal_tradition_trait_effect = {
	if = {
		limit = { scope:trait = flag:$TRAIT$ }
		$TRAIT$_legal_tradition_trait_effect = { MODE = effect_tooltip }
	}
	set_variable = tmp_$CATEGORY$ # Error suppression
	remove_variable = tmp_$CATEGORY$
}

set_legal_tradition_trait_flag_effect = {
	if = {
		limit = {  
			has_variable = $TRAIT$_rank
			var:$TRAIT$_rank >= $LEVEL$
		}
		set_variable = $FLAG$
	}
}

effect_tooltip_legal_tradition_trait_flag_effect = {
	if = {
		limit = {  
			scope:legal_tradition_scope = {
				has_variable = $TRAIT$_rank
				var:$TRAIT$_rank >= $LEVEL$
			}
		}
		custom_tooltip = $FLAG$_tooltip
	}
}

######################################
# TRADITION PROGRESS BACKEND EFFECTS #
######################################

add_legal_tradition_progress_effect = {
	if = {
		limit = { has_variable = legal_tradition_level_progress }
		custom_description = {
			text = gain_legal_tradition_progress
			subject = this
			value = $VALUE$
			change_variable = {
				name = legal_tradition_level_progress
				add = $VALUE$
			}
			if = {
				limit = {
					var:legal_tradition_level < 5
					var:legal_tradition_level_progress >= legal_tradition_next_level_progress_requirement_value  
				}
				set_variable = {
					name = legal_tradition_level_progress
					value = 0
				}
				change_variable = {
					name = legal_tradition_level
					add = 1
				}
			}
		}
	}
}

# Sets an AI's patronage policy
set_ai_patronage_level_effect = {
	if = {	# Characters that are greedy, insolvent or at war will never give squat
		limit = { 
			OR = {
				has_trait = greedy
				gold < 0
				monthly_character_income < 0
				is_at_war = yes
			}
		}
		if = {
			limit = { has_variable = character_legal_tradition_patronage_level }
			remove_variable = character_legal_tradition_patronage_level
		}
	}
	else_if = {	# Otherwise, characters will only patronize a school if they have the right personality and are a count or above
		limit = {
			highest_held_title_tier >= tier_county
			OR = {
				ai_zeal >= medium_positive_ai_value
				ai_greed <= medium_negative_ai_value
			}
		}
		random_list = {
			10 = { }
			15 = {
				set_variable = {
					name = character_legal_tradition_patronage_level
					value = 10
				}
			}
			10 = {
				set_variable = {
					name = character_legal_tradition_patronage_level
					value = 20
				}
			}
			5 = {
				set_variable = {
					name = character_legal_tradition_patronage_level
					value = 30
				}
			}
		}
	}
	update_legal_tradition_patronage_modifier_effect = yes
}

# Adds legal tradition progress from a patron while also adding said investments to the patron's lifetime contribution amount
add_legal_tradition_progress_from_patron_effect = {
	if = {
		limit = { has_variable = character_legal_tradition }
		save_temporary_scope_as = patron_scope
		var:character_legal_tradition = {
			add_legal_tradition_progress_effect = { VALUE = scope:patron_scope.legal_tradition_patronage_investment_character_total_value }
		}
		add_legal_tradition_patron_lifetime_contribution_effect = { VALUE = legal_tradition_patronage_investment_character_total_value }
		if = {
			limit = {
				exists = dynasty
				dynasty = { has_dynasty_perk = wardenite_legacy_1 }
			}
			add_prestige = legal_tradition_patronage_investment_character_total_value
			dynasty = {
				add_dynasty_prestige = {
					value = scope:patron_scope.legal_tradition_patronage_investment_character_total_value
					multiply = 0.1
				}
			}
		}
	}
}

# Adds legal tradition progress from a patron while also adding said investments to the patron's lifetime contribution amount
# This effect accepts a constant value as an argument instead of using the monthly income
add_legal_tradition_progress_from_patron_with_parameter_effect = {
	if = {
		limit = { has_variable = character_legal_tradition }
		save_temporary_scope_as = patron_scope
		var:character_legal_tradition = {
			add_legal_tradition_progress_effect = { VALUE = $VALUE$ }
		}
		add_legal_tradition_patron_lifetime_contribution_effect = { VALUE = $VALUE$ }
	}
}

# Adds VALUE to the patron's lifetime contribution to a legal tradition.
# If it exceeds the threshold to become a major patron
add_legal_tradition_patron_lifetime_contribution_effect = {
	if = {
		limit = { NOT = { has_variable = legal_tradition_patron_lifetime_contribution } }
		set_variable = {
			name = legal_tradition_patron_lifetime_contribution
			value = $VALUE$
		}
	}
	else = {
		change_variable = {
			name = legal_tradition_patron_lifetime_contribution
			add = $VALUE$
		}
	}
	if = {
		limit = {
			NOT = { has_variable = already_major_patron }
			var:legal_tradition_patron_lifetime_contribution >= 1500 
		}
		save_temporary_scope_as = patron_to_add
		var:character_legal_tradition = {
			add_legal_tradition_major_patron_effect = { PATRON = scope:patron_to_add }
		}
	}
}

#######################################
# TRADITION PATRONAGE BACKEND EFFECTS #
#######################################

update_legal_tradition_patronage_modifier_effect = {
	clear_legal_tradition_patronage_modifier_effect = yes
	if = {
		limit = { has_variable = character_legal_tradition_patronage_level }
		if = {
			limit = { var:character_legal_tradition_patronage_level = 10 }
			add_character_modifier = patronizing_legal_tradition_modifier_1
		}
		else_if = {
			limit = { var:character_legal_tradition_patronage_level = 20 }
			add_character_modifier = patronizing_legal_tradition_modifier_2
		}
		else_if = {
			limit = { var:character_legal_tradition_patronage_level = 30 }
			add_character_modifier = patronizing_legal_tradition_modifier_3
		}
		else_if = {
			limit = { var:character_legal_tradition_patronage_level = 40 }
			add_character_modifier = patronizing_legal_tradition_modifier_4
		}
		else_if = {
			limit = { var:character_legal_tradition_patronage_level = 50 }
			add_character_modifier = patronizing_legal_tradition_modifier_5
		}
	}
	if = {
		limit = { has_variable = character_legal_tradition }
		if = {
			limit = {  
				has_variable = character_legal_tradition_patronage_level
				var:character_legal_tradition_patronage_level > 0
			}
			var:character_legal_tradition = {
				add_to_variable_list = {
					name = legal_tradition_patrons
					target = prev
				}
			}
		}
		else = {
			var:character_legal_tradition = {
				remove_list_variable = {
					name = legal_tradition_patrons
					target = prev
				}
			}
			if = {
				limit = { has_variable = character_legal_tradition_patronage_level }
				remove_variable = character_legal_tradition_patronage_level
			}
		}
	}
	else_if = {
		limit = { has_variable = character_legal_tradition_patronage_level }
		remove_variable = character_legal_tradition_patronage_level
	}
}

clear_legal_tradition_patronage_modifier_effect = {
	remove_character_modifier = patronizing_legal_tradition_modifier_1
	remove_character_modifier = patronizing_legal_tradition_modifier_2
	remove_character_modifier = patronizing_legal_tradition_modifier_3
	remove_character_modifier = patronizing_legal_tradition_modifier_4
	remove_character_modifier = patronizing_legal_tradition_modifier_5
}

# Adds a character as a major patron of a legal tradition
add_legal_tradition_major_patron_effect = {
	add_to_variable_list = {
		name = legal_tradition_major_patrons
		target = $PATRON$
	}
	$PATRON$ = {
		if = {
			limit = { is_alive = yes }
			set_variable = already_major_patron
		}
	}
}

###########################
# JURIST PROGRESS EFFECTS #
###########################

add_jurist_progress_effect = {
	if = {
		limit = { NOT = { $VALUE$ = 0 } }
		custom_description = {
			text = gain_jurist_progress
			value = $VALUE$
			if = {
				limit = { NOT = { has_variable = jurist_level_progress } }
				set_variable = {
					name = jurist_level_progress
					value = $VALUE$
				}
			}
			else = {
				change_variable = {
					name = jurist_level_progress
					add = $VALUE$
				}
			}
			if = {
				limit = {
					NOT = { has_trait = jurist_5 }
				}
				# Lazy solution. Could be cleaner.
				if = {
					limit = {
						has_variable = jurist_level_progress
						var:jurist_level_progress >= root.jurist_next_level_progress_requirement_value 
					}
					change_variable = {
						name = jurist_level_progress
						subtract = root.jurist_next_level_progress_requirement_value
					}
					change_trait_rank = {
						trait = lifestyle_jurist
						rank = 1
					}
					if = {
						limit = { 
							NOT = { has_variable = character_legal_tradition }
							is_ai = yes
						}
						assign_character_legal_tradition_effect = yes
					}
					if = {
						limit = { var:jurist_level_progress >= root.jurist_next_level_progress_requirement_value }
						change_variable = {
							name = jurist_level_progress
							subtract = root.jurist_next_level_progress_requirement_value
						}
						change_trait_rank = {
							trait = lifestyle_jurist
							rank = 1
						}
						if = {
							limit = { var:jurist_level_progress >= root.jurist_next_level_progress_requirement_value }
							change_variable = {
								name = jurist_level_progress
								subtract = root.jurist_next_level_progress_requirement_value
							}
							change_trait_rank = {
								trait = lifestyle_jurist
								rank = 1
							}
							if = {
								limit = { var:jurist_level_progress >= root.jurist_next_level_progress_requirement_value }
								change_variable = {
									name = jurist_level_progress
									subtract = root.jurist_next_level_progress_requirement_value
								}
								change_trait_rank = {
									trait = lifestyle_jurist
									rank = 1
								}
								if = {
									limit = { var:jurist_level_progress >= root.jurist_next_level_progress_requirement_value }
									change_variable = {
										name = jurist_level_progress
										subtract = root.jurist_next_level_progress_requirement_value
									}
									change_trait_rank = {
										trait = lifestyle_jurist
										rank = 1
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

######################
# CORRUPTION EFFECTS #
######################

add_corruption_effect = {
	if = {
		limit = { NOT = { $VALUE$ = 0 } }
		custom_description = {
			text = gain_corruption
			value = $VALUE$
			if = {
				limit = { NOT = { has_variable = corruption } }
				set_variable = {
					name = corruption
					value = $VALUE$
				}
			}
			else = {
				change_variable = {
					name = corruption
					add = $VALUE$
				}
			}
		}
	}
}

######################
# RADICALISM EFFECTS #
######################

add_radicalism_effect = {
	if = {
		limit = { NOT = { $VALUE$ = 0 } }
		custom_description = {
			text = gain_radicalism
			value = $VALUE$
			if = {
				limit = { NOT = { has_variable = radicalism } }
				set_variable = {
					name = radicalism
					value = $VALUE$
				}
			}
			else = {
				change_variable = {
					name = radicalism
					add = $VALUE$
				}
			}
		}
		hidden_effect = {
			if = {
				limit = { has_variable = radicalism }
				if = {
					limit = { 
						var:radicalism > 100
						NOT = { has_character_modifier = radicalism_modifier_high }
					}
					remove_character_modifier = radicalism_modifier_low
					add_character_modifier = radicalism_modifier_high
				}
				else_if = {
					limit = { 
						var:radicalism > 50
						NOT = { has_character_modifier = radicalism_modifier_low }
					}
					remove_character_modifier = radicalism_modifier_high
					add_character_modifier = radicalism_modifier_low
				}
				else_if = {
					limit = { 
						var:radicalism <= 50
					}
					remove_character_modifier = radicalism_modifier_high
					remove_character_modifier = radicalism_modifier_low
				}
			}
		}
	}
}

########################
# PROSCRIPTION EFFECTS #
########################

# Sets a legal tradition as proscribed among faiths with the same religious head
set_legal_tradition_proscribed_effect = {
	save_temporary_scope_as = legal_tradition_to_proscribe
	$FAITH$.religion = {
		every_faith = {
			limit = { $FAITH$.religious_head = this.religious_head }
			# If the legal tradition was previously a recognized one, remove it from the list
			if = {
				limit = {
					has_variable_list = legal_traditions
					any_in_list = {
						variable = legal_traditions
						this = scope:legal_tradition_to_proscribe
					}
				}
				remove_list_variable = {
					name = legal_traditions
					target = scope:legal_tradition_to_proscribe
				}
			}
			add_to_variable_list = {
				name = proscribed_legal_traditions
				target = scope:legal_tradition_to_proscribe
			}
		}
	}
}

##############
# AI EFFECTS #
##############

assign_character_legal_tradition_effect = {
	if = {
		limit = { 
			faith = {
				has_variable_list = recognized_high_court_list 
				any_in_list = {
					variable = recognized_high_court_list
					has_variable_list = legal_traditions
				}
			}
		}
		save_temporary_scope_as = character_being_checked
		faith = {
			random_in_list = {
				variable = recognized_high_court_list
				limit = { has_variable_list = legal_traditions }
				save_temporary_scope_as = court_to_pick_tradition_from
			}
		}
		scope:court_to_pick_tradition_from = {
			random_in_list = {
				variable = legal_traditions
				weight = {
					base = 1
					modifier = {
						add = legal_tradition_character_alignment_value
					}
				}
				save_temporary_scope_as = tradition_to_join
			}
		}
		if = {
			limit = { exists = scope:tradition_to_join }
			join_legal_tradition_effect = { LEGAL_TRADITION = scope:tradition_to_join }
		}
	}
	else_if = {
		limit = { religion = { has_variable_list = legal_traditions } }
		save_temporary_scope_as = character_being_checked
		religion = {
			random_in_list = {
				variable = legal_traditions
				weight = {
					base = 1
					modifier = {
						add = legal_tradition_character_alignment_value
					}
				}
				save_temporary_scope_as = tradition_to_join
			}
		}
		if = {
			limit = { exists = scope:tradition_to_join }
			join_legal_tradition_effect = { LEGAL_TRADITION = scope:tradition_to_join }
		}
	}
}

####################################
# LEGAL TRADITION MODIFIER EFFECTS #
####################################

set_valid_legal_tradition_modifier_effect = {
	if = {
		limit = {
			exists = var:character_legal_tradition
			var:character_legal_tradition = {
				has_variable = $MODIFIER$
			}
		}
		add_character_modifier = $MODIFIER$
	}
}

remove_legal_tradition_modifier_effect = {
	if = {
		limit = { has_character_modifier = $MODIFIER$ }
		remove_character_modifier = $MODIFIER$
	}
}

###########################################
# LEGAL TRADITION HISTORICAL INFO EFFECTS #
###########################################

# Adds a historical major patron to a legal tradition
add_historical_legal_tradition_major_patron_effect = {
	if = {
		limit = { current_date >= $YEAR$ }
		add_legal_tradition_major_patron_effect = { PATRON = $PATRON$ }
	}
}

# Sets a historical tradition's founder
set_legal_tradition_founder_effect = {
	set_variable = {
		name = legal_tradition_founder
		value = $FOUNDER$
	}
}


# Sets a historical tradition's founder
set_legal_tradition_founding_century_effect = {
	set_variable = {
		name = legal_tradition_founding_century
		value = $CENTURY$
	}
}

#########################
# LEGAL LEGACY EFFECTS #
#########################

wardenite_legacy_3_jurist_progress_effect = {
	if = {
		limit = { 
			faith = { has_doctrine_parameter = enables_practising_law }
			exists = liege.dynasty
			liege.dynasty = { has_dynasty_perk = wardenite_legacy_3 }
			exists = dynasty
			dynasty = liege.dynasty
		}
		add_jurist_progress_effect = { VALUE = learning }
	}
}