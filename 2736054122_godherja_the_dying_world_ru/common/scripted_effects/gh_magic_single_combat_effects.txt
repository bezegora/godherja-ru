single_magic_combat_test_effect_thing = {
	set_variable = {
		name = tier_0_magic_counter
		value = 3
	}
	set_variable = {
		name = tier_1_magic_counter
		value = 0
	}
	set_variable = {
		name = tier_2_magic_counter
		value = 0
	}
	set_variable = {
		name = tier_3_magic_counter
		value = 0
	}
}

select_magic_combat_options_from_pool_effect = {
	remove_single_combat_magic_character_local_variables_effect = yes
	if = { 
		limit = { var:magical_prowess = { compare_value < 5 } }
		set_variable = {
			name = tier_0_magic_counter
			value = 2
		}
		set_variable = {
			name = tier_1_magic_counter
			value = 0
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 8 } }
		random_list = {
			2 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 2
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 0
				}
			}
			2 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 0
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 10 } }
		random_list = {
			2	= {
				set_variable = {
					name = tier_0_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
			}
			2 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 0
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 2
				}
			}
			1 = {
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 15 } }
		random_list = {
			2 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 0
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 2
				}
			}
			2 = {
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 20 } }
		random_list = {
			1 = {
				set_variable = {
					name = tier_0_magic_counter
					value = 0
				}
				set_variable = {
					name = tier_1_magic_counter
					value = 2
				}
			}
			2 = {
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
			}
			2 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 25 } }
		random_list = {
			1 = {
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 30 } }
		random_list = {
			1 = {
				set_variable = {
					name = tier_1_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
			}
			3 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 40 } }
		random_list = {
			9 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 50 } }
		random_list = {
			4 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 60 } }
		random_list = {
			3 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
			2 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 70 } }
		random_list = {
			3 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
			2 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_3_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 80 } }
		random_list = {
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 2
				}
			}
			2 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_3_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = { 
		limit = { var:magical_prowess = { compare_value < 80 } }
		random_list = {
			1 = {
				set_variable = {
					name = tier_2_magic_counter
					value = 1
				}
				set_variable = {
					name = tier_3_magic_counter
					value = 1
				}
			}
			1 = {
				set_variable = {
					name = tier_3_magic_counter
					value = 2
				}
			}
		}
	}
	else_if = {
		limit = { has_variable = magical_prowess }
		set_variable = {
			name = tier_3_magic_counter
			value = 2
		}	
	}
	else = {
	}
	select_magic_combat_moves_effect
}

select_magic_combat_moves_effect = {
	if = {
		limit = {
			has_variable = tier_0_magic_counter
			var:tier_0_magic_counter > 0
		}
		change_variable = {
			name = tier_0_magic_counter
			add = -1
		}
		select_tier_0_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_0_magic_counter
			var:tier_0_magic_counter > 0
		}
		change_variable = {
			name = tier_0_magic_counter
			add = -1
		}
		select_tier_0_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_1_magic_counter
			var:tier_1_magic_counter > 0
		}
		change_variable = {
			name = tier_1_magic_counter
			add = -1
		}
		select_tier_1_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_1_magic_counter
			var:tier_1_magic_counter > 0
		}
		change_variable = {
			name = tier_1_magic_counter
			add = -1
		}
		select_tier_1_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_2_magic_counter
			var:tier_2_magic_counter > 0
		}
		change_variable = {
			name = tier_2_magic_counter
			add = -1
		}
		select_tier_2_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_2_magic_counter
			var:tier_2_magic_counter > 0
		}
		change_variable = {
			name = tier_2_magic_counter
			add = -1
		}
		select_tier_2_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_3_magic_counter
			var:tier_3_magic_counter > 0
		}
		change_variable = {
			name = tier_3_magic_counter
			add = -1
		}
		select_tier_3_magic_move_effect = yes
	}
	if = {
		limit = {
			has_variable = tier_3_magic_counter
			var:tier_3_magic_counter > 0
		}
		change_variable = {
			name = tier_3_magic_counter
			add = -1
		}
		select_tier_3_magic_move_effect = yes
	}
}

remove_single_combat_magic_character_local_variables_effect = {
	## Tier 0 moves
	remove_local_variable = magic_combat_move_tier_0_generic_blast_flag
	remove_local_variable = magic_combat_move_tier_0_ward_flag
	## Tier 1 moves
	remove_local_variable = magic_combat_move_tier_1_generic_blast_flag
	remove_local_variable = magic_combat_move_tier_1_ward_flag
	## Tier 2 moves
	remove_local_variable = magic_combat_move_tier_2_generic_blast_flag
	remove_local_variable = magic_combat_move_tier_2_ward_flag
	## Tier 3 moves
	remove_local_variable = magic_combat_move_tier_3_generic_blast_flag
	remove_local_variable = magic_combat_move_tier_3_ward_flag
}

select_tier_0_magic_move_effect = {
	random_list = {
		1000 = { # generic placeholder magic blast
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_generic_blast_flag
					exists = local_var:magic_combat_move_tier_1_generic_blast_flag
					exists = local_var:magic_combat_move_tier_2_generic_blast_flag
					exists = local_var:magic_combat_move_tier_3_generic_blast_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_0_generic_blast_flag
				value = yes
			}
		}
		1000 = { # magic ward
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_ward_flag
					exists = local_var:magic_combat_move_tier_1_ward_flag
					exists = local_var:magic_combat_move_tier_2_ward_flag
					exists = local_var:magic_combat_move_tier_3_ward_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_0_ward_flag
				value = yes
			}
		}
	}
}

select_tier_1_magic_move_effect = {
	random_list = {
		1000 = { # generic placeholder magic blast
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_generic_blast_flag
					exists = local_var:magic_combat_move_tier_1_generic_blast_flag
					exists = local_var:magic_combat_move_tier_2_generic_blast_flag
					exists = local_var:magic_combat_move_tier_3_generic_blast_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_1_generic_blast_flag
				value = yes
			}
		}
		1000 = { # magic ward
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_ward_flag
					exists = local_var:magic_combat_move_tier_1_ward_flag
					exists = local_var:magic_combat_move_tier_2_ward_flag
					exists = local_var:magic_combat_move_tier_3_ward_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_1_ward_flag
				value = yes
			}
		}
	}
}

select_tier_2_magic_move_effect = {
	random_list = {
		1000 = { # generic placeholder magic blast
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_generic_blast_flag
					exists = local_var:magic_combat_move_tier_1_generic_blast_flag
					exists = local_var:magic_combat_move_tier_2_generic_blast_flag
					exists = local_var:magic_combat_move_tier_3_generic_blast_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_2_generic_blast_flag
				value = yes
			}
		}
		1000 = { # magic ward
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_ward_flag
					exists = local_var:magic_combat_move_tier_1_ward_flag
					exists = local_var:magic_combat_move_tier_2_ward_flag
					exists = local_var:magic_combat_move_tier_3_ward_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_2_ward_flag
				value = yes
			}
		}
	}
}

select_tier_3_magic_move_effect = {
	random_list = {
		1000 = { # generic placeholder magic blast
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_generic_blast_flag
					exists = local_var:magic_combat_move_tier_1_generic_blast_flag
					exists = local_var:magic_combat_move_tier_2_generic_blast_flag
					exists = local_var:magic_combat_move_tier_3_generic_blast_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_3_generic_blast_flag
				value = yes
			}
		}
		1000 = { # magic ward
			trigger = {
				NOT = { 
					OR = {
					exists = local_var:magic_combat_move_tier_0_ward_flag
					exists = local_var:magic_combat_move_tier_1_ward_flag
					exists = local_var:magic_combat_move_tier_2_ward_flag
					exists = local_var:magic_combat_move_tier_3_ward_flag					
					}
				}
			}
			set_local_variable = {
				name = magic_combat_move_tier_3_ward_flag
				value = yes
			}
		}
	}
}

magic_combat_move_tier_0_generic_blast_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_0_generic_blast
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_0_generic_blast
		}
	}
	
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_medium
		DUEL_SUCCESS = duel_success_low
	}
}

magic_combat_move_tier_0_ward_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_0_ward
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_0_ward
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_low
		DUEL_SUCCESS = duel_success_none
	}
}

magic_combat_move_tier_1_generic_blast_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_1_generic_blast
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_1_generic_blast
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_medium
		DUEL_SUCCESS = duel_success_medium
	}
}

magic_combat_move_tier_1_ward_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_1_ward
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_1_ward
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_none
		DUEL_SUCCESS = duel_success_none
	}
}

magic_combat_move_tier_2_generic_blast_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_2_generic_blast
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_2_generic_blast
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_medium
		DUEL_SUCCESS = duel_success_high
	}
}

magic_combat_move_tier_2_ward_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_2_ward
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_2_ward
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_none
		DUEL_SUCCESS = duel_success_low
	}
}

magic_combat_move_tier_3_generic_blast_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_3_generic_blast
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_3_generic_blast
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_low
		DUEL_SUCCESS = duel_success_very_high
	}
}

magic_combat_move_tier_3_ward_effect = {
	if = {
		limit = { this = scope:sc_attacker }
		save_scope_value_as = {
			name = sc_attacker_last_move
			value = flag:tier_3_ward
		}
	}
	if = {
		limit = { this = scope:sc_defender }
		save_scope_value_as = {
			name = sc_defender_last_move
			value = flag:tier_3_ward
		}
	}
	adjust_risk_reward_effect = {
		INJURY_RISK = injury_risk_none
		DUEL_SUCCESS = duel_success_high
	}
}