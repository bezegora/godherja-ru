
story_cycle_high_court = {

	on_setup = {
		set_variable = {
			name = high_court_legitimacy
			value = 62
		}
	}

	on_end = {
	
	}

	on_owner_death = {
	
	}
	
	# Monthly legitimacy change
	effect_group = {
		months = 1
	
		trigger = {
			has_variable_list = high_court_seat_list
			any_in_list = {
				variable = high_court_seat_list
				exists = var:seat_occupant
				var:seat_occupant = { is_alive = yes }
			}
		}
	
		first_valid = {
			triggered_effect = {
				trigger = {
					has_variable = high_court_legitimacy
				}
				effect = {
					change_variable = {
						name = high_court_legitimacy
						add = monthly_high_court_legitimacy_change_value
					}
					if = {
						limit = { var:high_court_legitimacy > 100 }
						set_variable = {
							name = high_court_legitimacy
							value = 100
						}
					}
					else_if = {
						limit = { var:high_court_legitimacy < 0 }
						set_variable = {
							name = high_court_legitimacy
							value = 0
						}
					}
				}
			}
			triggered_effect = {
				trigger = {  
					NOT = { has_variable = high_court_legitimacy }
				}
				effect = {
					set_variable = {
						name = high_court_legitimacy
						value = monthly_high_court_legitimacy_change_value
					}
				}
			}
		}
	}
	
	# Monthly mamurial authority change
	effect_group = {
		months = 1
	
		trigger = {
			has_variable_list = high_court_seat_list
			any_in_list = {
				variable = high_court_seat_list
				exists = var:seat_occupant
				var:seat_occupant = { is_alive = yes }
			}
			exists = var:high_court_mamuramat
			exists = var:high_court_mamuramat.holder
		}
	
		first_valid = {
			triggered_effect = {
				trigger = {
					has_variable = high_court_mamurial_authority
				}
				effect = {
					change_variable = {
						name = high_court_mamurial_authority
						add = monthly_high_court_mamurial_authority_change_value
					}
					if = {
						limit = { var:high_court_mamurial_authority > 100 }
						set_variable = {
							name = high_court_mamurial_authority
							value = 100
						}
					}
					else_if = {
						limit = { var:high_court_mamurial_authority < 0 }
						set_variable = {
							name = high_court_mamurial_authority
							value = 0
						}
					}
				}
			}
			triggered_effect = {
				trigger = {  
					NOT = { has_variable = high_court_mamurial_authority }
				}
				effect = {
					set_variable = {
						name = high_court_mamurial_authority
						value = monthly_high_court_mamurial_authority_change_value
					}
				}
			}
		}
	}
	
	# Yearly legitimacy level check
	effect_group = {
		years = 1
	
		trigger = {
			has_variable = high_court_legitimacy
		}
	
		first_valid = {
			triggered_effect = {
				trigger = {
					always = yes
				}
				effect = {
					apply_high_court_legitimacy_doctrine_effect = yes
				}
			}
		}
	}
	
	# Yearly legitimacy level check (mamuramat modifier)
	effect_group = {
		years = 1
	
		trigger = {
			exists = var:high_court_mamuramat
			exists = var:high_court_mamuramat.holder
		}
	
		first_valid = {
			triggered_effect = {
				trigger = {
					always = yes
				}
				effect = {
					apply_high_court_legitimacy_mamur_modifier_effect = yes
				}
			}
		}
	}
	
	# Minor legal tradition check
	effect_group = {
		years = 10
	
		trigger = {
			has_variable_list = legal_traditions
		}
	
		first_valid = {
			triggered_effect = {
				trigger = {
					always = yes
				}
				effect = {
					save_temporary_scope_as = high_court
					if = {
						limit = {
							variable_list_size = {
								name = legal_traditions
								value < 10
							}
						}
						random = {
							chance = 15
							modifier = {
								factor = 2
								variable_list_size = {
									name = legal_traditions
									value < 6
								}
							}
							generate_procedural_legal_tradition_effect = { LEVEL = 0 TRAIT_POINTS = 4 }
							scope:created_legal_tradition = {
								assign_legal_tradition_to_high_court_effect = { HIGH_COURT = high_court }
								set_variable = {
									name = legal_tradition_creation_cooldown
									years = 50
								}
							}
							every_player = {
								limit = {
									faith = {
										save_temporary_scope_as = player_faith
									}
									root = {
										is_target_in_variable_list = {
											name = faiths_recognizing_high_court
											target = scope:player_faith
										}
									}
								}
								trigger_event = legal_tradition.1021
							}
						}
					}
					if = {
						limit = {
							NOT = { exists = scope:created_legal_tradition }
							variable_list_size = {
								name = legal_traditions
								value > 4
							}
							any_in_list = {
								variable = legal_traditions
								legal_tradition_eligible_for_deletion_trigger = yes
							}
						}
						random = {
							chance = 15
							modifier = {
								factor = 2
								variable_list_size = {
									name = legal_traditions
									value > 7
								}
							}
							random_in_list = {
								variable = legal_traditions
								limit = { legal_tradition_eligible_for_deletion_trigger = yes }
								save_scope_as = tradition_to_delete
							}
							scope:tradition_to_delete = {
								delete_legal_tradition_effect = yes
							}
							every_player = {
								limit = {
									faith = {
										save_temporary_scope_as = player_faith
									}
									root = {
										is_target_in_variable_list = {
											name = faiths_recognizing_high_court
											target = scope:player_faith
										}
									}
								}
								trigger_event = legal_tradition.1031
							}
						}
					}
				}
			}
		}
	}
}
