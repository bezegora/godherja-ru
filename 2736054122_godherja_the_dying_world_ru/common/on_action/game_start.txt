on_opening_events = {
    effect = {
        every_player = { #Opening Events
			trigger_event = world_story.1001
			if { #give megistos third person
				limit = {
					has_title = title:k_kasmiene
				}
				add_character_flag = { flag = megistos_flag years = 1000 }
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.1 #Black Sun
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.2 #Dexios
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.3 #Aironoi Generic
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.4 #Hecuba
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.6 #Gorassos
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.7 #Magistos
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.8 #Adriane
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.9 #Heraklios
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.3 #Mamur
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.11 #Adalgar
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.12 #Epghar-Argeadh
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.13 #Mathilde
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.14 #Rene
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.15 #Cliement
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.16 #Ansfrei
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.17 #Benouet
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.18 #Cois
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.19 #Fenrus
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.20 #Kekropi
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.21 #Melane
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.22 #Ulfirx
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.4 #Harthah
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.24 #Hammart
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.5 #Pejman
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.26 #Msamaki
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.27 #Ogiers
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.28 #Aeschraes
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.29 #Cenware
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.30 #Sigrun
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.31 #Dragos
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.32 #Isa
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.33 #Sirras
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.34 #Iordanes
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.1 #Aarif
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.2 #opening event for amsari vassals
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.36 #Aderi
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.37 #Farwah
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.38 #Rashali
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.39 #Herizab
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.40 #Runalem
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.41 #Azhela
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event_sarradon.6 #opening event for marcher trading company
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.42 #Krehejad Archex
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.43 #FRIDGE
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.44 #ACHAKE
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.45 #Metal Mask
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.46 #Puppet Draneti
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.47 #Akakih the White Lion
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.48 #Last Ertomaxist
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.49 #Vakhtan Vampire Uncle
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.50 #Tarnaz Hedonist Brother
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.51 #Khvicha Barbarian Brother
				}
			}
			if {
				limit = {
					has_game_rule = opening_events_enabled
				}
				trigger_event = {
					id = opening_event.52 #Parnaz paranoid magi brother
				}
			}
			initialize_metropoli_effect = yes
		}
	}
}

# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
on_game_start_after_lobby = {
	effect = {
		trade_strait_table_effect = { MODE = initialize }
		### GAME RULE: VIEW ON SAME-SEX RELATIONS
		if = {
			limit = { has_game_rule = accepted_same_sex_relations }
			game_rule_accepted_same_sex_relations_effect = yes
		}

		### GAME RULE: RANDOM RULER PLACEMENT
		#if = {
		#	limit = { NOT = { has_game_rule = random_ruler_placement_off } }
		#	game_rule_random_ruler_placement_effect = yes
		#}

		### GAME RULE: RANDOMIZE FAITH
		#if = {
		#	limit = { has_game_rule = randomized_faiths_on }
		#	game_rule_randomize_faith_effect = yes
		#}

		### GAME RULE: FAITH ACCEPTANCE
		if = {
			limit = { has_game_rule = full_faith_acceptance }
			game_rule_faith_acceptance_effect = yes
		}

		### GAME RULE: GENDER EQUALITY ###
		if = {
			limit = { has_game_rule = full_gender_equality }
			game_rule_full_gender_equality_effect = yes
		}
		else_if = {
			limit = { has_game_rule = inversed_gender_equality }
			game_rule_inversed_gender_equality_effect = yes #todo fix
		}

		### GAME RULE: SEXUALITY DISTRIBUTION ###
		if = {
			limit = { NOT = { has_game_rule = sexuality_distribution_default } }
			game_rule_sexuality_distribution_effect = yes
		}
		
		### GAME RULE: WASTELAND COLORS ###
		if = {
			limit = { has_game_rule = wasteland_color_black }
			every_kingdom = {
				limit = {
					exists = holder
					holder = { has_trait = gh_wasteland } 
				}
				set_color_from_title = title:k_wasteland_black
			}
		}
		else_if = {
			limit = { has_game_rule = wasteland_color_white }
			every_kingdom = {
				limit = { holder = { has_trait = gh_wasteland } }
				set_color_from_title = title:k_wasteland_white
			}
		}
		
		### GAME RULE: UNIVERSAL BLOOD SENATE ###
		if = {
			limit = { has_game_rule = hammarts_wild_ride_enabled }
			every_living_character = {
				if = {
					limit = {
						OR = {
							NOT = {
								any_held_county = {
									any_county_province = {
										geographical_region = world_ga_marcher_kingdoms
									}
								}
							}
							has_title = title:d_callesc
						}
					}
					remove_trait = magic_good_1
					remove_trait = magic_good_2
					remove_trait = magic_good_3
					remove_trait = magic_good_4
					remove_trait = magic_good_5
					remove_trait = magic_good_6
					remove_trait = magic_good_7
					remove_trait = magic_good_8
					remove_trait = magic_good_9
					remove_trait = magic_good_10
					remove_trait = magic_good_11
					remove_trait = magic_good_12
					remove_trait = magic_good_13
					remove_trait = magic_good_14
					remove_trait = magic_good_15
					remove_trait = magic_good_16
					remove_trait = magic_good_17
					remove_trait = magic_good_18
					remove_trait = magic_good_19
					remove_trait = education_living_magic_1
					remove_trait = education_living_magic_2
					remove_trait = education_living_magic_3
					remove_trait = education_dead_magic_1
					remove_trait = education_dead_magic_2
					remove_trait = education_dead_magic_3
					remove_trait = education_mixed_magic_1
					remove_trait = education_mixed_magic_2
					remove_trait = education_mixed_magic_3
					add_trait = magic_good_20
					add_trait = education_living_magic_4
					add_trait = education_dead_magic_4
					add_trait = education_mixed_magic_4
				}
			}
		}
		### ACHIEVEMENT: FROM RAGS TO RICHES
		every_player = {
			limit = { highest_held_title_tier = tier_county }
			add_achievement_global_variable = {
				VARIABLE = achievement_rags_to_riches_valid
				VALUE = yes
			}
		}
	}

	events = {
		game_rule.1000	#Autopopulate families.
		fogeater_invasion.9000 #Decide when invasion happens
		adabyss_event.9000 #decides when invasion happens
	}
	
	on_actions = {
		on_opening_events
		delay = { years = 46 }
		dissolve_aversarian_titles
	}
}