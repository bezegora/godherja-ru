# Called from code after history generation
# Empty scope
on_game_start = { 

	events = {
		fp1_scandinavian_adventurers.0004	# FP1 - Organise Godherja adventurers.
		#gh_pirate.0013  					# Organises the Godherja pirates.
	}

	effect = {
		set_global_variable = {
			name = global_year_variable
			value = 1254
		}
		intialize_game_rule_categories_effect = yes
		#preplan_shattered_coast_conquest_realms_effect = yes
		#Moon phase
		initialize_moon_phase_information_effect = yes
		#initialize_historical_information = yes
		initialize_historical_building_construction_dates_effect = yes
	
		initialize_artifacts = yes
		initialize_traditional_borders = yes
		initialize_influx_cultures_kalathipsomi = yes
		
		initialize_global_hunting_information = yes

		initialize_coastal_county_list = yes
		trade_strait_table_effect = { MODE = initialize }
		
		intial_adventure_spawn = yes
		mayikprolollan_adventure_spawn = yes
		kamsaria_adventure_spawn = yes
		oejeynica_adventure_spawn = yes
		sarradon_adventure_spawn = yes
		
		trigger_event = agionist.0001
		initialize_clique_history_effect = yes
		update_global_clique_information = yes

		#konijkmener traits
		if = {
			limit = { exists = title:k_de_kanzelerij.holder }
			title:k_de_kanzelerij.holder = {
				every_vassal = {
					limit = {
						NOT = {
							OR = {
								has_trait = konijkmener_peopleofunity
								has_trait = konijkmener_councilists
								#has_trait = konijkmnener_neutral
							}
						}
					}
					random_list = {
						33 = {
							add_trait = konijkmener_peopleofunity
						}
						33 = {
							add_trait = konijkmener_councilists
						}
						34 = {
							#add_trait = konijkmener_neutral
						}						
					}
				}
			}
		}
		character:clanlands_sjalvolki_1 = {
			everybody_loves_cenware = yes
			if = { 
				limit = {
					has_game_rule = imperrech_destroyed
				}
				destroy_title = title:e_sjalvolki
			}
			else = {
				add_character_modifier = {
					modifier = gh_imperrech_debuff_modifier
				}
			}
		}
		character:sarradon_1 = {
			create_story = {
				type = story_cycle_harthah
			}
		}
		title:e_northwatch = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_western_undercity_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_northgrove = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:k_westkatraddia_2 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:k_westkatraddia_3 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:k_westkatraddia_5 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:d_westkatraddia_14 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:d_westkatraddia_17 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_southkatraddia_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_easternkatraddia = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { faith = faith:aversarinas_aautokrata }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_northern_katraddia = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_reduvias = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_northern_lichdoms = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_east_lichdoms = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_west_lichdoms_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_westcatacombs = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_eastcatacombs = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_sunken_depths_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_red_chasm_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_abyssal_pits = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_eastern_undercity_1 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_easternkatraddia90707 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:k_abyssal_magic_hell = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
					NOT = { religion = religion:ethowos_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
		title:e_mayikprolollan = {
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					NOT = { religion = religion:samojitian_religion }
					NOT = { religion = religion:aversarinas_aautokrata_religion }
					NOT = { religion = religion:ethowos_religion }
					NOT = { religion = religion:marcher_religion }
					NOT = { religion = religion:sjalvolki_religion }
					NOT = { religion = religion:kakarataki_religion }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
            }
		}
        title:d_manasupa = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:k_easternkatraddia8 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:e_whisperveil = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:d_westkatraddia_18 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:d_westkatraddia_12aa = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:d_westkatraddia_15 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { faith = faith:fogeater }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:k_south_bedouins_3 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { culture = culture:takopara }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
     	title:k_south_bedouins_52 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { culture = culture:takopara }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:k_south_bedouins_30 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { culture = culture:ndoufre }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
     	title:k_south_bedouins_2 = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { culture = culture:ndoufre }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:k_narmer = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
					NOT = { culture = culture:takopara }
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}
		title:k_seratossim = {
			every_in_de_jure_hierarchy = {
				limit = { 
					tier = tier_county
				}
				save_temporary_scope_as = ruined_county
				spawn_ruin = { COUNTY = scope:ruined_county }
			}
		}		
		character:rhesus_1 = {	# Rhesus has such an iron-fisted control over the realm that this effect is intentionally called twice
			generate_web_of_intrigue = yes
			generate_web_of_intrigue = yes
		}
		
		initialize_all_study_chains_effect = yes
		
		set_lifepath_dedication = yes
		set_valid_lifepaths_all_faiths = yes
		
		initialize_starting_judges_effect = yes
		
		# Initial Fog stuff
		init_fog_locations = yes
		init_fog_parameters = yes
		
		# Waylines
		set_all_waylines = yes
		
		# Trade Routes
		set_traderoutes = yes
		set_harbours = yes
		set_entrepots = yes

		# Marcher Antimagic Field
		set_antimagic_field = yes
		
		if = {
			limit = {
				has_game_rule = default_adabyss_invasion
			}
			title:e_limpegail.holder = {
				trigger_event = {
					id = adabyss_opening.2
				}
			}
		}
		
		populate_with_wayfathers = yes
		
		if = {
			limit = { game_start_date >= 1200.1.1 }
			spawn_red_waste = yes
			spawn_eripomvuno = yes
		}
		
		#Damotan lodges
		initialize_lodge_power_effect = yes
		
		if = {
			limit = { character:western_imperial_1 = { is_alive = yes } }
			character:western_imperial_1 = {
				set_variable = {
					name = magic_counter
					value = 300
				}
			}
		}
		
		if = {
			limit = { character:clanlands_sjalvolki_1 = { is_alive = yes } }
			character:clanlands_sjalvolki_1  = {
				add_opinion = {
					modifier = gh_cormag_dislike
					target = character:clanlands_sjalvolki_2
				}
			}
		}

		if = {
			limit = { character:clanlands_sjalvolki_2 = { is_alive = yes } }
			character:clanlands_sjalvolki_2  = {
				add_opinion = {
					modifier = gh_cormag_dislike
					target = character:clanlands_sjalvolki_1
				}
			}
		}

		if = {
			limit = { character:cois_1 = { is_alive = yes } }
			character:cois_1 = {
				set_variable = {
					name = conclave_immunity_cooldown
					days = 180
				}
			}
		}
		
		every_ruler = {
			limit = {
				has_government = pirate_government
			}
			trigger_event = {
				id = gh_pirate.0020
			}
		}
		# Legal Traditions
		initialize_wardenite_high_courts_effect = yes
		every_living_character = {
			limit = {
				exists = primary_title
				primary_title.tier = tier_barony
				is_adult = yes
				OR = {
					has_government = theocracy_government
					primary_title.title_province = {
						has_holding_type = church_holding
					}
				}
				faith = { has_doctrine_parameter = judges_act_as_clergy }
				NOT = { has_trait = lifestyle_jurist }
			}
			random_list = {
				20 = {}
				30 = {
					add_trait = jurist_1
				}
				20 = {
					add_trait = jurist_2
				}
				10 = {
					trigger = {
						age >= 25
					}
					add_trait = jurist_3
				}
				5 = {
					trigger = {
						age >= 35
					}
					add_trait = jurist_4
				}
				1 = {
					trigger = {
						age >= 45
					}
					add_trait = jurist_5
				}
			}
		}
		every_living_character = {
			limit = { 
				has_trait = lifestyle_jurist
				NOT = { has_variable = character_legal_tradition }
			}
			assign_character_legal_tradition_effect = yes
		}
		
		every_kingdom = {
			limit = {
				is_title_created = yes
				is_agionist_holy_order_trigger = yes
			}
			holder = {
				create_alliance_with_title_or_synonym = { TITLE = title:k_saint_sansias_rose   }
				create_alliance_with_title_or_synonym = { TITLE = title:k_forlorn_guardian     }
				create_alliance_with_title_or_synonym = { TITLE = title:k_golden_hand          }
				create_alliance_with_title_or_synonym = { TITLE = title:k_saint_calystos_key   }
				create_alliance_with_title_or_synonym = { TITLE = title:k_bleeding_martyr      }
				create_alliance_with_title_or_synonym = { TITLE = title:k_pure_heart           }
				create_alliance_with_title_or_synonym = { TITLE = title:k_blind_watcher        }
				create_alliance_with_title_or_synonym = { TITLE = title:k_forgotten_saint      }
			}
		}
	}

	on_actions = {
		on_monthly
		
		on_yearly_marcher
		on_yearly_legacy_of_elysia_check
		on_yearly_legacy_of_icw_check
		on_yearly_ruined_by_ulfrix_check
		on_yearly_amsari_blood_check
		bloodline_set_founders
		bloodline_add_member
		bloodline_inheritors
		on_monthly_cenware_doomed_war_winner
		
		vampire_start_check_pulse

		
		vampire_start_check_pulse

		# these two are from artifacts, as there can only be one on_game_start
		on_artifact_initialization
		on_monthly_artifacts
		
		delay = { days = 1 }
		initialize_magi_on_action
		initialize_lifepath_on_action
		
		clique_government_pulse
	}
}

#Runs code that needs to happen every month
on_monthly = {
	effect = {
		#########
		# MAGIC #
		#########
		global_magic_calculations = yes							# Initializes and/or updates all passive magic generation related variables for all magi
		every_in_global_list = {
			variable = non_magi_with_exposure
			reduce_overwhelmation = yes
		}
		
		every_independent_ruler = {		
			if = {
				limit = { 
					OR = {	
						has_trait = coronated_by_head_of_religion	
						has_trait = coronated_by_high_priest
						has_trait = coronated_by_bishop
						has_trait = coronated_formal_3
						has_trait = coronated_formal_2
						has_trait = coronated_formal_1
						has_trait = coronated_celebration
					}
				}
				clear_uncoronated_debuff = yes
			}			
		}

		# update pirates smuggling lists and remove counties that have reached 100 control
		every_independent_ruler = {
			if = {
				limit = {
					has_government = pirate_government
				}
				update_shadow_ports_list_and_value = yes
			}
		}
		# update the trade confluences
		trade_strait_table_effect = { MODE = update}
		####################
		# LEGAL TRADITIONS #
		####################
		update_global_legal_tradition_information_effect = yes
	}
	
	
	on_actions = {
		delay = { months = 1 }
		on_monthly
	}
}

on_biannual_fog = {
	effect = {
		trigger_event = {
			id = gh_fog_spread_events.1
		}
		every_ruler = {
			limit = { 
				faith = faith:fogeater 
			}
			trigger_event = gh_fog_spread_events.5
		}
	}
}

biannual_moon_cycle = {
	effect = {
		advance_moon_phase = yes
		if = {
			limit = {
				is_any_good_moon_trigger = yes
				NOT = { is_full_moon_trigger = yes}
				}
			every_ruler = {
				limit = {
					has_perk = deadmagic_perk9_tree3
				}
				add_character_modifier = { modifier = lunar_power_good months = 6}
			}
		}
		if = {
			limit = {
				is_full_moon_trigger = yes
				}
			every_ruler = {
				limit = {
					has_perk = deadmagic_perk9_tree3
				}
				add_character_modifier = { modifier = lunar_power_full months = 6}
			}
		}	
	}
}

yearly_gedeora_pulse = {
	effect = {
		random_list = {
			80 = { }	# Has a 20% chance of striking each year
			20 = {
				trigger = { NOT = { has_game_rule = gedeora_disabled } }
				trigger_event = {
					id = gedeora.0001
					days = { 1 360 }
				}
			}
		}
	}
}

on_yearly_marcher = {
	effect = {
		every_ruler = {
			limit = { has_culture_group = culture_group:gh_marcher_group }
			random_list = {
				98 = {  } # Nothing
				1 = { trigger_event = { id = marcher.0101 days = { 1 350 } } } # Wounded Griffon
				1 = { trigger_event = { id = marcher.0103 days = { 1 350 } } } # Griffon Trainer
			}
		}
	}	
	
	on_actions = {
		delay = {months = 12}
		on_yearly_marcher
	}
}

on_yearly_legacy_of_elysia_check = {	# Yearly check to give Aversarian counties in Etepezea the Legacy of Elysia modifier. Should self-terminate after 1304 AD
	effect = {
		if = {	# If the date is post 1304, remove the modifier everywhere and self-terminate the on_action
			limit = { current_date >= 1304.1.1 }
			every_county_in_region = {
				region = world_ga_western_aversaria
				if = {
					limit = { has_county_modifier = legacy_of_elyssia }
					remove_county_modifier = legacy_of_elyssia
				}
			}
		}
		else = {
			every_county_in_region = {
				region = world_ga_western_aversaria
				if = {
					limit = {
						has_county_modifier = legacy_of_elyssia
						holder.top_liege.primary_title = title:e_sjalvolki
					}
					remove_county_modifier = legacy_of_elyssia
				}
				else_if = {
					limit = {
						holder.culture_group = culture_group:gh_imperial_group
						NOR = {
							has_county_modifier = legacy_of_elyssia
							holder.top_liege.primary_title = title:e_sjalvolki
						}
					}
					add_county_modifier = legacy_of_elyssia
				}
			}
			trigger_event = {
				on_action = on_yearly_legacy_of_elysia_check
				days = 360
			}
		}
	}
}

on_yearly_legacy_of_icw_check = {	# Yearly check to give Aversarian counties in Opakhasia the Legacy of the Civil War modifier. Should self-terminate after 1286 AD
	effect = {
		if = {	# If the date is post 1286, remove the modifier everywhere and self-terminate the on_action
			limit = { current_date >= 1286.1.1 }
			every_county_in_region = {
				region = world_ga_central_aversaria
				if = {
					limit = { has_county_modifier = legacy_of_icww }
					remove_county_modifier = legacy_of_icww
				}
			}
		}
		else = {
			every_county_in_region = {
				region = world_ga_central_aversaria
				if = {
					limit = {
						has_county_modifier = legacy_of_icww
						holder.top_liege.primary_title = title:e_sjalvolki
					}
					remove_county_modifier = legacy_of_icww
				}
				else_if = {
					limit = {
						holder.culture_group = culture_group:gh_imperial_group
						NOR = {
							has_county_modifier = legacy_of_icww
							holder.top_liege.primary_title = title:e_sjalvolki
						}
					}
					add_county_modifier = legacy_of_icww
				}
			}
			trigger_event = {
				on_action = on_yearly_legacy_of_icw_check
				days = 360
			}
		}
	}
}

on_yearly_ruined_by_ulfrix_check = {	# Yearly check to give Aversarian island counties in Opakhasia the Raided by Ulfrix modifier. Should self-terminate after 1284 AD
	effect = {
		if = {	# If the date is post 1284, remove the modifier everywhere and self-terminate the on_action
			limit = { current_date >= 1284.1.1 }
			every_county_in_region = {
				region = world_ga_aversarian_isles
				if = {
					limit = { has_county_modifier = ruined_by_ulfrix }
					remove_county_modifier = ruined_by_ulfrix
				}
			}
		}
		else = {
			every_county_in_region = {
				region = world_ga_aversarian_isles
				if = {
					limit = {
						has_county_modifier = ruined_by_ulfrix
						holder.top_liege.primary_title = title:e_sjalvolki
					}
					remove_county_modifier = ruined_by_ulfrix
				}
				else_if = {
					limit = {
						holder.culture_group = culture_group:gh_imperial_group
						NOR = {
							has_county_modifier = ruined_by_ulfrix
							holder.top_liege.primary_title = title:e_sjalvolki
						}
					}
					add_county_modifier = ruined_by_ulfrix
				}
			}
			trigger_event = {
				on_action = on_yearly_ruined_by_ulfrix_check
				days = 360
			}
		}
	}
}

yearly_aervalr_shard_pulse = {
	effect = {
		random_list = {
			60 = { } # Nothing, Aervalr shards should fall once every 3 years or so.
			30 = { trigger_event = {
					id = aervalr.0100
					days = { 1 360 }
				}
			}
		}
	}
}

on_yearly_amsari_blood_check = {	# Yearly check to see if the Amsari empire has the Prophets blood trait
	effect = {
		if = {
			limit = { 
				title:e_amsari = {
					holder = {
						NOT = {
							has_global_variable = amsari_blood_length
							has_trait = bloodline_the_prophet
						}
					}
				}
			}
			set_global_variable = {
				name = amsari_blood_length
				value = 1
			}
		}
		if = {
			limit = { 
				title:e_amsari = {
					holder = {
						NOT = {
							has_trait = bloodline_the_prophet
						}
					}
				}
			}
			change_global_variable = {
				name = amsari_blood_length
				add = 1
			}
		}
		if = {
			limit = {
				global_var:amsari_blood_length >= 50
				NOT = {
					has_global_variable = reformed_amsari
				}
			}
			title:e_amsari = {
				holder = {
					trigger_event = amsari.0010
					every_vassal = {
						limit = {
							is_landed = yes
						}
						trigger_event = amsari.0010
					}
					destroy_title = title:e_amsari
				}
			}
		}
	}

	on_actions = {
		delay = { months = 12}
		on_yearly_amsari_blood_check
	}
}

initialize_magi_on_action = {
	effect = {
		every_living_character = {
			limit = { can_access_magic = yes }
			give_mixed_magi_riftsight_effect = yes
			add_to_magi_list = yes
		}
		every_in_global_list = {
			variable = magi_list
			calculate_monthly_magic = yes
			calculate_magical_prowess = yes
			combine_regular_and_magic_prowess = { DAYS = 364 }
		}
	}
}

initialize_lifepath_on_action = {
	effect = {
		assign_all_lifepath_trait = yes
	}
}

sjalvolki_conquest_events = {
	random_events = {
		100 = 0
		3 = sjalvolki_conquest.0100
		4 = sjalvolki_conquest.0101 
		3 = sjalvolki_conquest.0120
		3 = sjalvolki_conquest.0122
		3 = sjalvolki_conquest.0123
		3 = sjalvolki_conquest.0124
		3 = sjalvolki_conquest.0126
		4 = sjalvolki_conquest.0127
		3 = sjalvolki_conquest.0128
		3 = sjalvolki_conquest.0129
		3 = sjalvolki_conquest.0130
		3 = sjalvolki_conquest.0131
		3 = sjalvolki_conquest.0132
		3 = sjalvolki_conquest.0138
		3 = sjalvolki_conquest.0141
		3 = sjalvolki_conquest.0144
		3 = sjalvolki_conquest.0145
		3 = sjalvolki_conquest.0146
#		3 = sjalvolki_conquest.0148
	}
}

on_monthly_cenware_doomed_war_winner = {	# If AI Cenware is at war with other AI and he has over 75% warscore, auto win it instead of wasting his time
	effect = {
		if = {
			limit = { 
				character:clanlands_sjalvolki_1 = { 
					is_alive = yes
					has_title = title:e_sjalvolki
				} 
			}
			character:clanlands_sjalvolki_1 = {
				if = {
					limit = { is_at_war = yes }
					if = {
						limit = {
							OR = {
								any_character_war = {
									any_war_attacker = { this = character:clanlands_sjalvolki_1 }
									attacker_war_score >= 50
									NOR = {
										character:clanlands_sjalvolki_1 = { is_ai = no }
										any_war_defender = { is_ai = no }
									}
								}
								any_character_war = {
									any_war_defender = { this = character:clanlands_sjalvolki_1 }
									defender_war_score >= 40
									NOR = {
										character:clanlands_sjalvolki_1 = { is_ai = no }
										any_war_attacker = { is_ai = no }
									}
								}
							}
						}
					}
					every_character_war = {
						limit = {
							any_war_attacker = { this = character:clanlands_sjalvolki_1 }
							attacker_war_score >= 50
							NOR = {
								character:clanlands_sjalvolki_1 = { is_ai = no }
								any_war_defender = { is_ai = no }
							}
						}
						end_war = attacker
					}
					every_character_war = {
						limit = {
							any_war_defender = { this = character:clanlands_sjalvolki_1 }
							defender_war_score >= 40
							NOR = {
								character:clanlands_sjalvolki_1 = { is_ai = no }
								any_war_attacker = { is_ai = no }
							}
						}
						end_war = defender
					}
				}
			}
			trigger_event = {
				on_action = on_monthly_cenware_doomed_war_winner
				days = 30
			}
		}
	}
}

vampire_start_check_pulse = {
	effect = {
		every_county = {
			limit = {
				trigger_if = {
					limit = { exists = empire }
					OR = {
						empire = title:e_megos_kalathipsomi
						empire = title:e_mikros_kalathipsomi
					}
				}
				trigger_else = { always = no }
			}
			set_variable = {
				name = dominant_vampire_faith
				value = faith:aversarinas_aautokrata
				years = 50
			}
			set_variable = {
				name = dominant_vampire_culture
				value = culture:northernimperial
				years = 50
			}
			set_variable = {
				name = temporary_vampire_check_block
				days = 5
			}
		}
	}
	on_actions = {
		vampire_information_check_pulse
	}
}

vampire_information_check_pulse = {	# Checks county vampire population information, once every 10 years
	effect = {
		every_county = {
			limit = { NOT = { has_variable = temporary_vampire_check_block } }
			save_temporary_scope_as = county_being_checked
			set_variable = {
				name = dominant_vampire_faith
				value = scope:county_being_checked.faith
			}
			set_variable = {
				name = dominant_vampire_culture
				value = scope:county_being_checked.culture
			}
		}
	}
}

clique_government_pulse = {
	effect = {
		every_ruler = {
			limit = { 
				should_have_own_cliques_trigger = yes
				NOT = {
					any_held_title = {
						has_variable = clique_number
					}
				}
			}
			assign_cliques_to_primary_title = yes
		}
	}
	
	on_actions = {
		delay = { months = 60 }
		clique_government_pulse
	}
}

dissolve_aversarian_titles = {
	effect = {
		dissolve_aversarian_titles = yes
	}
}