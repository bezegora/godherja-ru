


# Give a suitable County to Genghis
give_scathach_arawn_land_effect = {
	save_scope_as = fogeater_leader

	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:c_gwynavon_uchav = {
		change_title_holder = {
			holder = scope:fogeater_leader
			change = scope:title_change
		}
	}
	title:d_gwynavony = {
		change_title_holder = {
			holder = scope:fogeater_leader
			change = scope:title_change
		}
	}	
	resolve_title_and_vassal_change = scope:title_change
}

# A wild Genghis Khan appears!
spawn_scathach_arawn_character_effect = {
	title:c_gwynavon_uchav.title_province = {
		save_scope_as = scathach_arawn_birthplace
	}

	create_character = {
		name = "Scathach Arawn" # AKA: Genghis Khan
		gender = male
		location = scope:scathach_arawn_birthplace
		template = scathach_arawn_character_template
		save_scope_as = scathach_arawn
	}
	scope:scathach_arawn = {
		# Make temporarily immune to disease
		add_character_flag = {
			flag = immune_to_disease
			years = 40
		}

		add_trait = fogeater_invasion_leader
		give_scathach_arawn_land_effect = yes
		add_gold = 5000
		add_dread = high_dread
		spawn_scathach_arawn_court_effect = yes
		form_the_fogeater_empire_effect = yes
		intial_fogland_subjugation = yes
		spawn_fogeater_troops_effect = yes ###will lose half of troops when the guy dies
		add_prestige = 10000
		add_piety = 5000
		dynasty = {
			add_dynasty_prestige_level = 5
			add_dynasty_prestige = 10000
			add_dynasty_perk = warfare_legacy_1
			add_dynasty_perk = warfare_legacy_2
			add_dynasty_perk = warfare_legacy_3
			add_dynasty_perk = warfare_legacy_4
		}
	}
	

	every_player = {
		trigger_event = fogeater_invasion.1002 # Mongol Empire spawned notification
	}
}


# Form the actual Mongol Empire...
form_the_fogeater_empire_effect = {
	save_scope_as = fogeater_founder
	
	#Create the title
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:e_foglands = {
		change_title_holder = {
			holder = scope:fogeater_founder
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change

	add_realm_law_skip_effects = high_partition_succession_law

	assert_if = {
		limit = { NOT = { exists = title:e_foglands } }
		text = "Foglands title was not created!"
	}

	hidden_effect = { set_primary_title_to = title:e_foglands }

	spawn_fogeater_troops_effect = yes
	change_government = tribal_government
	every_held_title = {
		limit = {
			tier = tier_empire
			NOT = { this = title:e_foglands }
		}
		scope:fogeater_founder = {
			destroy_title = prev
		}
	}

	add_character_modifier = {
		modifier = fogeater_invasion_leader_modifier
	}

	set_global_variable = {
		name = fogeater_empire_has_spawned
		value = yes
	}
}

# Make sure the Empire has troops...
spawn_fogeater_troops_effect = {
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = fogeater_event_troops
		levies = {
			value = 4000
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = whisperers
			stacks = 5
		}
		men_at_arms = {
			type = mangonel
			stacks = 5
		}
		men_at_arms = {
			type = fogbeasts
			stacks = 5
		}
		men_at_arms = {
			type = fog_spirits
			stacks = 5
		}
		location = capital_province
	}
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = fogeater_event_troops
		levies = {
			value = 4000
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = whisperers
			stacks = 4
		}
		men_at_arms = {
			type = mangonel
			stacks = 2
		}
		men_at_arms = {
			type = fogbeasts
			stacks = 5
		}
		men_at_arms = {
			type = fog_spirits
			stacks = 5
		}
		location = capital_province
	}
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = fogeater_event_troops
		levies = {
			value = 4000
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = whisperers
			stacks = 3
		}
		men_at_arms = {
			type = mangonel
			stacks = 2
		}
		men_at_arms = {
			type = fogbeasts
			stacks = 5
		}
		men_at_arms = {
			type = fog_spirits
			stacks = 5
		}
		location = capital_province
	}
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = fogeater_event_troops
		levies = {
			value = 4000
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = whisperers
			stacks = 3
		}
		men_at_arms = {
			type = mangonel
			stacks = 2
		}
		men_at_arms = {
			type = fogbeasts
			stacks = 5
		}
		men_at_arms = {
			type = fog_spirits
			stacks = 5
		}
		location = capital_province
	}
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = fogeater_event_troops
		levies = {
			value = 4000
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = wodes
			stacks = 10
		}
		men_at_arms = {
			type = whisperers
			stacks = 3
		}
		men_at_arms = {
			type = mangonel
			stacks = 2
		}
		men_at_arms = {
			type = fogbeasts
			stacks = 5
		}
		men_at_arms = {
			type = fog_spirits
			stacks = 5
		}
		location = capital_province
	}	
}


### Populating the life of Temujin...
spawn_scathach_arawn_court_effect = {
	add_character_flag = is_scathach_arawn
	
	# Create (wife)...
	create_character = {
		template = cailleach_character_template
		name = "Cailleach" # Wife of Temujin
		gender = female
		employer = scope:scathach_arawn
		save_scope_as = cailleach
	}
	
	scope:cailleach = {
		marry = scope:scathach_arawn
		# Make temporarily immune to disease
		add_character_flag = {
			flag = immune_to_disease
			years = 20
		}
	}
	if = {
		limit = {
			scope:scathach_arawn = { is_male = yes }
		}
		scope:scathach_arawn = { save_scope_as = great_khan_family_father }
		scope:cailleach = { save_scope_as = great_khan_family_mother }
	}	
	
	create_character = {
		template = unnon_character_template
		name = "Unnon" 
		employer = scope:scathach_arawn
		mother = scope:great_khan_family_mother
		father = scope:great_khan_family_father
		save_scope_as = unnon
	}	
	scope:unnon = {
		# Make temporarily immune to disease
		add_character_flag = {
			flag = immune_to_disease
			years = 20
		}
	}	

	# Create (Commander)...
	create_character = {
		template = tir_eowa_character_template
		name = "Tir Eowa" # (Temujin's Commander of armies)
		gender = male
		employer = scope:scathach_arawn
		save_scope_as = tir_eowa
	}

	scope:tir_eowa = {
		# Make temporarily immune to disease
		add_character_flag = {
			flag = immune_to_disease
			years = 10
		}
		# Set friendship with Temujin
		set_relation_friend = scope:scathach_arawn
	}
	
	# Spawn some generic Bagathurs
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
	create_character = {
		gender_female_chance = root_soldier_female_chance
		employer = scope:scathach_arawn
		template = new_warrior_character
		faith = scope:scathach_arawn.faith
		culture = scope:scathach_arawn.culture
	}
}

##war effects, subjugation, and ai

intial_fogland_subjugation = {
	save_scope_as = fogeater_emperor
	add_character_flag = {
		flag = free_fogeater_cb
		days = 20
	}
	
	every_independent_ruler = {
		limit = {
			NOT = { is_allied_to = scope:fogeater_emperor }
			any_sub_realm_county = {
				title_province = { geographical_region = world_ga_foglands }
			}
		}
		
		trigger_event = {
			id = fogeater_invasion.2001
			days = { 3 12 }
		}
		
		save_temporary_scope_as = subjugation_offer_recipient
		scope:fogeater_emperor = {
			add_to_variable_list = {
				name = subjugation_offer_under_consideration
				target = scope:subjugation_offer_recipient
			}
		}
	}
}	

fogeater_ai_effect = {	
	every_independent_ruler = {
		limit = {
			has_character_modifier = fogeater_invasion_leader_modifier
		}
		save_scope_as = gets_fogeater_ai
	}
	scope:gets_fogeater_ai = {
		if = {
			limit = { 
				is_ai = yes
				NOT = { 
					is_at_war = yes 
				}
				has_title = title:e_foglands
			}
			
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_thanatosia }	#foglands and blakc pass
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_creytos }	
	
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_lieben }	#mountain heights
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_lyckholm }
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_buzi }
			
			fogeater_conquer_empire = { EMPIRE_NAME = e_vevred }
			fogeater_conquer_empire = { EMPIRE_NAME = e_peferania }
			fogeater_conquer_empire = { EMPIRE_NAME = e_vedrelkv }
			fogeater_conquer_empire = { EMPIRE_NAME = e_faragard }
			fogeater_conquer_empire = { EMPIRE_NAME = e_peresk }
			fogeater_conquer_empire = { EMPIRE_NAME = e_jsav }
			
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_vyshtanka }
			fogeater_conquer_kingdom = { KINGDOM_NAME = k_niidinia }
			
			fogeater_conquer_empire = { EMPIRE_NAME = e_bleskci }
			fogeater_conquer_empire = { EMPIRE_NAME = e_desiv }
			fogeater_conquer_empire = { EMPIRE_NAME = e_ruski }
			fogeater_conquer_empire = { EMPIRE_NAME = e_yiev }
			fogeater_conquer_empire = { EMPIRE_NAME = e_kalav }			
			fogeater_conquer_empire = { EMPIRE_NAME = e_daavragard }
			fogeater_conquer_empire = { EMPIRE_NAME = e_guggarv }
			
			fogeater_conquer_empire = { EMPIRE_NAME = e_mikros_kalathipsomi } ##clean up- big foggo should be dead by now
			fogeater_conquer_empire = { EMPIRE_NAME = e_megos_kalathipsomi }
			fogeater_conquer_empire = { EMPIRE_NAME = e_gurdurbok }
			fogeater_conquer_empire = { EMPIRE_NAME = e_mayikprolollan }
			fogeater_conquer_empire = { EMPIRE_NAME = e_chevalie }
		}
	}
}

fogeater_conquer_kingdom = { 
	if = {
		limit = { 
			NOT = { has_variable = ai_fogeater_recently_launched_invasion } 
		}
		title:$KINGDOM_NAME$ = {
			if = {
				limit = {
					any_in_de_jure_hierarchy = {
						tier = tier_county 
						NOT = { 
							holder.top_liege = scope:gets_fogeater_ai
						}
					}
				}
				random_in_de_jure_hierarchy = {
					limit = { 
						tier = tier_county 
						NOT = { 
							holder.top_liege = scope:gets_fogeater_ai
						}
					}
					kingdom = { save_scope_as = defender_title }
					holder.top_liege = { save_scope_as = defender }
					scope:gets_fogeater_ai = {

						set_variable = {
							name = ai_fogeater_recently_launched_invasion
							days = 10
						}
						start_war = {
							cb = fogeater_realm_invasion_war
							target = scope:defender
							target_title = scope:defender_title
						}
					}
				}
			}
		}
		fogeater_consume_effect = yes
	}
}

fogeater_conquer_empire = { 
	if = {
		limit = { 
			NOT = { has_variable = ai_fogeater_recently_launched_invasion } 
		}
		title:$EMPIRE_NAME$ = {
			if = {
				limit = {
					any_in_de_jure_hierarchy = {
						tier = tier_county 
						NOT = { 
							holder.top_liege = scope:gets_fogeater_ai
						}
					}
				}
				random_in_de_jure_hierarchy = {
					limit = { 
						tier = tier_county 
						NOT = { 
							holder.top_liege = scope:gets_fogeater_ai
						}
					}
					empire = { save_scope_as = defender_title }
					holder.top_liege = { save_scope_as = defender }
					scope:gets_fogeater_ai = {

						set_variable = {
							name = ai_fogeater_recently_launched_invasion
							days = 10
						}
						start_war = {
							cb = fogeater_realm_invasion_war
							target = scope:defender
							target_title = scope:defender_title
						}
					}
				}
			}
		}
		fogeater_consume_effect = yes
	}
}



fogeater_consume_effect = {

	create_title_and_vassal_change = {
		type = revoked
		save_scope_as = change
	}

	every_vassal_or_below = {
		limit = {
			NOT = { culture_group = culture_group:gh_fog_eaters_group }
		}
		prev = {
			imprison = {
				target = prev
				type = dungeon
			}
		}
		every_held_title = {
            limit = {
            trigger_if = {
              limit = { tier = tier_barony }
              is_capital_barony = no
            }
            trigger_else = { always = yes }
            }
            change_title_holder = {
                holder = root
                change = scope:change
            }
        }
	}

	resolve_title_and_vassal_change = scope:change

	every_held_title = {
		limit = {
			trigger_if = {
				limit = { tier = tier_county }
				NOT = { culture_group = culture_group:gh_fog_eaters_group }
			}
			trigger_else = { always = no }
		}
		
		set_county_culture = root.culture
		set_county_faith = root.faith

		root = {
			add_prestige = minor_prestige_gain
			add_piety = minor_piety_gain
		}
	}

	every_prisoner = {
		limit = {
			NOT = { culture_group = culture_group:gh_fog_eaters_group }
		}
		death = {
			death_reason = death_execution
			killer = root
		}

		IF = {
			limit = {
				highest_held_title_tier = tier_empire
			}
			root = {
				add_prestige = medium_prestige_gain
				add_piety = medium_piety_gain
			}
		}
		ELSE_IF = {
			limit = {
				highest_held_title_tier = tier_kingdom
			}
			root = {
				add_prestige = minor_prestige_gain
				add_piety = minor_piety_value
			}
		}
		ELSE_IF = {
			limit = {
				highest_held_title_tier = tier_duchy
			}
			root = {
				add_prestige = miniscule_prestige_gain
				add_piety = {
					value = miniscule_piety_gain
					add = minor_piety_gain
					divide = 2

					# rounds to closest 5
					divide = 5
					ceiling = yes
					multiply = 5
				}
			}
		}
		ELSE_IF = {
			limit = {
				highest_held_title_tier = tier_county
			}
			root = {
				add_prestige = {
					value = miniscule_prestige_gain
					multiply = 2
				}
				add_piety = miniscule_piety_gain
			}
		}
		ELSE_IF = {
			limit = {
				highest_held_title_tier = tier_barony
			}
			root = {
				add_prestige = miniscule_prestige_gain
				add_piety = miniscule_piety_gain
			}
		}
		ELSE = {
			root = {
				add_piety = miniscule_piety_gain
			}
		}
	}
}



	
		
